package com.huateng.hstserver.communicate.mina.main;


import java.security.InvalidKeyException;
import java.security.KeyFactory;
import java.security.NoSuchAlgorithmException;
import java.security.PublicKey;
import java.security.Signature;
import java.security.spec.InvalidKeySpecException;
import java.security.spec.X509EncodedKeySpec;

import org.apache.log4j.Logger;

import com.huateng.hstserver.communicate.mina.comm.common.DataTrans.DataTransTools;
import com.huateng.hstserver.communicate.mina.comm.common.DataTrans.Exception.NotHexStringException;



public class RSATest {
	private static Logger logger = Logger.getLogger(RSATest.class);
	/*public static void main(String[] argv) throws NoSuchAlgorithmException, NotHexStringException, CertificateException, InvalidKeyException, SignatureException
	{
		//����
		String rsMiwen = "C1BA397311A3CE7E81A3C52110BF27376CE1A2732E42662505704698F36C51BA9BD782AB243FEC673EF9657EE7718E4C1A6686E5C173DDF88330FEB613E64642EC0872F674CCD092A874ECA7FF61FDFEB035584788AF3108DA55EA140C09F96B62329DB2D282FCF471924722F7D7D7D7F2F3118FB78719C92C3C5E2A3C558572";
		//����
		String mw =      "88800095722000120171004000420295611021207905561000000SUCCESSRSADODIRECTPAYMENT000150000138****1232201102120790556120171004113250SUCCESS"; 
		//֤��
		String hexpb =   "308203243082028FA00302010202030FB939300B06092A864886F70D0101053039310B300906035504061302434E310D300B060355040A0C04434D4341311B301906035504030C12434D434120456E7465727072697365204341301E170D3130313033303039323334335A170D3132313033303039323334335A3076310B300906035504061302434E310F300D06035504080C06E6B996E58D97310F300D06035504070C06E995BFE6B2993145304306035504030C3CE4B8ADE59BBDE7A7BBE58AA8E9809AE4BFA1E99B86E59BA2E6B996E58D97E69C89E99990E585ACE58FB8E794B5E5AD90E59586E58AA1E4B8ADE5BF8330819D300B06092A864886F70D01010103818D0030818902818100F3B098D9E1A8139E21A54198DB01EB184E4A72764DFB3D0DCB2CA0CA9A65763E710927DD0FFF2A4DE12956968C5D34700E0A0CACEC3E615DB13CEEF4BDDCAE5DCC3F278F4FCCE9606CB2F496E916E27B7987E79CA476FAA387FF435D25FB6D3A5C37F7A2BE40E7F15E0F5AD8CA20E243D3EA1514FC19AD5BAAB6ACD3D33E27F30203010001A38201013081FE30340603551D25042D302B06082B0601050507030206082B0601050507030106096086480186F8420401060A2B0601040182370A0303301F0603551D23041830168014C615ED2E6C22F594D1E4D5E1C4BA9DBB2FF7450230790603551D1F04723070306EA02DA02B8629687474703A2F2F7777772E636D63612E6E65742F646F776E6C6F61642F63726C2F43524C322E63726CA23DA43B3039311B301906035504030C12434D434120456E7465727072697365204341310D300B060355040A0C04434D4341310B300906035504061302434E300B0603551D0F0404030200F1301D0603551D0E04160414F912A1DB6B4ED0EBF1759A507BE9754AED408370300B06092A864886F70D010105038181008F2D6FDE2E474D6E03FEB2485BFBE50B01364D8DC266D8555D0ECBC2CDFE3398ED9CC562D2F4EBBBEFA864010F714778AEC62C282CCAA33BFB71402F5162D10071EDD30067B1B85ECBF36B44B27E721E11EB65BDC8A469CA930475EE1C6181D8947872521AED0A7F60E6A1F2EFACEF25DF3289B6714C5D750384B8B89A7BEA6C";

		byte[] pu = DataTransTools.hexStringToByte(hexpb);
		InputStream bais = new ByteArrayInputStream(pu);
		CertificateFactory cf   =   CertificateFactory.getInstance("X.509"); 
		X509Certificate   cert   =   (X509Certificate)cf.generateCertificate(bais); 
		PublicKey publicKey = cert.getPublicKey();

		Signature s = Signature.getInstance("MD5WithRSA");
//		Signature s = Signature.getInstance("RSA");
		s.initVerify(publicKey);
		s.update(mw.getBytes());
		System.out.print(s.verify(DataTransTools.hexStringToByte(rsMiwen)));

	}*/
	
	
	public static void main1(String[] argv) throws NotHexStringException, InvalidKeySpecException, NoSuchAlgorithmException, InvalidKeyException
	{
		String hexKeyString = "308203243082028FA00302010202030FB939300B06092A864886F70D0101053039310B300906035504061302434E310D300B060355040A0C04434D4341311B301906035504030C12434D434120456E7465727072697365204341301E170D3130313033303039323334335A170D3132313033303039323334335A3076310B300906035504061302434E310F300D06035504080C06E6B996E58D97310F300D06035504070C06E995BFE6B2993145304306035504030C3CE4B8ADE59BBDE7A7BBE58AA8E9809AE4BFA1E99B86E59BA2E6B996E58D97E69C89E99990E585ACE58FB8E794B5E5AD90E59586E58AA1E4B8ADE5BF8330819D300B06092A864886F70D01010103818D0030818902818100F3B098D9E1A8139E21A54198DB01EB184E4A72764DFB3D0DCB2CA0CA9A65763E710927DD0FFF2A4DE12956968C5D34700E0A0CACEC3E615DB13CEEF4BDDCAE5DCC3F278F4FCCE9606CB2F496E916E27B7987E79CA476FAA387FF435D25FB6D3A5C37F7A2BE40E7F15E0F5AD8CA20E243D3EA1514FC19AD5BAAB6ACD3D33E27F30203010001A38201013081FE30340603551D25042D302B06082B0601050507030206082B0601050507030106096086480186F8420401060A2B0601040182370A0303301F0603551D23041830168014C615ED2E6C22F594D1E4D5E1C4BA9DBB2FF7450230790603551D1F04723070306EA02DA02B8629687474703A2F2F7777772E636D63612E6E65742F646F776E6C6F61642F63726C2F43524C322E63726CA23DA43B3039311B301906035504030C12434D434120456E7465727072697365204341310D300B060355040A0C04434D4341310B300906035504061302434E300B0603551D0F0404030200F1301D0603551D0E04160414F912A1DB6B4ED0EBF1759A507BE9754AED408370300B06092A864886F70D010105038181008F2D6FDE2E474D6E03FEB2485BFBE50B01364D8DC266D8555D0ECBC2CDFE3398ED9CC562D2F4EBBBEFA864010F714778AEC62C282CCAA33BFB71402F5162D10071EDD30067B1B85ECBF36B44B27E721E11EB65BDC8A469CA930475EE1C6181D8947872521AED0A7F60E6A1F2EFACEF25DF3289B6714C5D750384B8B89A7BEA6C";
		
		byte[] keyBytes = DataTransTools.hexStringToByte("308203243082028FA00302010202030FB939300B06092A864886F70D0101053039310B300906035504061302434E310D300B060355040A0C04434D4341311B301906035504030C12434D434120456E7465727072697365204341301E170D3130313033303039323334335A170D3132313033303039323334335A3076310B300906035504061302434E310F300D06035504080C06E6B996E58D97310F300D06035504070C06E995BFE6B2993145304306035504030C3CE4B8ADE59BBDE7A7BBE58AA8E9809AE4BFA1E99B86E59BA2E6B996E58D97E69C89E99990E585ACE58FB8E794B5E5AD90E59586E58AA1E4B8ADE5BF8330819D300B06092A864886F70D01010103818D0030818902818100F3B098D9E1A8139E21A54198DB01EB184E4A72764DFB3D0DCB2CA0CA9A65763E710927DD0FFF2A4DE12956968C5D34700E0A0CACEC3E615DB13CEEF4BDDCAE5DCC3F278F4FCCE9606CB2F496E916E27B7987E79CA476FAA387FF435D25FB6D3A5C37F7A2BE40E7F15E0F5AD8CA20E243D3EA1514FC19AD5BAAB6ACD3D33E27F30203010001A38201013081FE30340603551D25042D302B06082B0601050507030206082B0601050507030106096086480186F8420401060A2B0601040182370A0303301F0603551D23041830168014C615ED2E6C22F594D1E4D5E1C4BA9DBB2FF7450230790603551D1F04723070306EA02DA02B8629687474703A2F2F7777772E636D63612E6E65742F646F776E6C6F61642F63726C2F43524C322E63726CA23DA43B3039311B301906035504030C12434D434120456E7465727072697365204341310D300B060355040A0C04434D4341310B300906035504061302434E300B0603551D0F0404030200F1301D0603551D0E04160414F912A1DB6B4ED0EBF1759A507BE9754AED408370300B06092A864886F70D010105038181008F2D6FDE2E474D6E03FEB2485BFBE50B01364D8DC266D8555D0ECBC2CDFE3398ED9CC562D2F4EBBBEFA864010F714778AEC62C282CCAA33BFB71402F5162D10071EDD30067B1B85ECBF36B44B27E721E11EB65BDC8A469CA930475EE1C6181D8947872521AED0A7F60E6A1F2EFACEF25DF3289B6714C5D750384B8B89A7BEA6C");
		
		String keydata = new String(keyBytes);
		
		logger.info(keydata);
		
		byte[] hexKeyBytes = hexKeyString.getBytes();
		
		
		
		String sampleBase64Key = "M2lbqYiz1M4rrqjDwnT1B+NXEIHS34w9CuvwyQn4ILlariQgpCdrut44VZ+1jXQAJv8i3MWZHYwQgJTQZ+ZpJ7DJJRWisP6QV9tNux3DqMsnCnwFrJewaLqWdcnibGTAwAr6wKF+A3G/uWGEqg4rkndLGuYIh8P5Whn+RBSYDjyJzgh+C3PwLUDDqWHERpwrFd8bhMbFwzmoDV6G1WzvRG5BmYX8XK+eUqCwzcrje9ik7UL5oSRCgT/tRGdShKqgQzGc1071drA0G2ExdqfQThJ0oP747dF+KPOrV+/NgRC5YFfHP4hn6s7rUs0wopEyaV2H87dqfmNVzsEGIYL30Q==";
	/*	byte[] sampleBase64KeyBytes = 
		
		
		   // ����X509EncodedKeySpec����     
	       X509EncodedKeySpec keySpec = new X509EncodedKeySpec(keyBytes);
//		X509EncodedKeySpec keySpec = new X509EncodedKeySpec(hexKeyBytes);  
	   
	       // KEY_ALGORITHM ָ���ļ����㷨     
	       KeyFactory keyFactory = KeyFactory.getInstance("RSA");     
	  
	      // ȡ��Կ�׶���     
	      PublicKey pubKey = keyFactory.generatePublic(keySpec);     
	  
	      Signature signature = Signature.getInstance("MD5WithRSA");     
	      signature.initVerify(pubKey);     
//	     signature.update(data);     
	  
		*/
		logger.info(keydata);
		
	}
	
	
	public static boolean verify(byte[] data, String publicKey, String sign)      
	           throws Exception {     
			
		
		   
		  
		
	      // ������base64����Ĺ�Կ     
	       byte[] keyBytes = publicKey.getBytes();     
	   
	       // ����X509EncodedKeySpec����     
	       X509EncodedKeySpec keySpec = new X509EncodedKeySpec(keyBytes);     
	   
	       // KEY_ALGORITHM ָ���ļ����㷨     
	       KeyFactory keyFactory = KeyFactory.getInstance("RSA");     
	  
	      // ȡ��Կ�׶���     
	      PublicKey pubKey = keyFactory.generatePublic(keySpec);     
	  
	      Signature signature = Signature.getInstance("MD5WithRSA");     
	      signature.initVerify(pubKey);     
	     signature.update(data);     
	     
	     return false;
	     
	      // ��֤ǩ���Ƿ���     
//	      return signature.verify(decryptBASE64(sign));     
	      
	      /*
	      byte[] pu =hexStrToBytes(pubkey);

			X509EncodedKeySpec keySpec = new X509EncodedKeySpec(pu);
				KeyFactory factory = KeyFactory.getInstance("RSA");
			PublicKey publicKey = factory.generatePublic(keySpec);
			// ��ȡ����
			Signature s = Signature.getInstance("MD5WithRSA");
			// ��ʼ��
			s.initVerify(publicKey);
			// ����ԭʼ���
			s.update(dataString.getBytes());
			
			flag = s.verify(hexStrToBytes(signedString));
	      */
	   }      


}
