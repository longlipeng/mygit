<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TXNPOINT">
  <select id="selectTXNPOINTByDTO" parameterClass="com.huateng.accorecard.memberwebsite.dto.TxnPointQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select T1.CARD_NO   as "cardNo",
    substr(t1.CARD_NO,1,8) || '*******' || substr(t1.CARD_NO,16,4) as "cardNoHid",
    T2.TXN_NUM   as "txnNum",
    to_char(t1.TXN_AMT/100, '9999999990.00') as "txnAmt",
    T3.MERCHANT_NAME  as "merchantName",
    T2.INST_TIME  as "instTime",
    to_char(to_date(T1.SETTLE_DATE, 'YYYYMMDD'), 'YYYY-MM-DD')     as "settleDate",
    T1.POINT       as "point",
  	T4.POINTS      as "points"
	from TB_TXN_POINT T1,
     TBL_TXN_HIS   T2,
     TB_ENT_MERCHANT T3,
     TB_MEMBER_INFO   T4
	where  T2.DATE_SETTLMT=T1.SETTLE_DATE
	and    T2.RETRIVL_REF=T1.RETRIVL_REF
	and    T3.MERCHANT_ID=T2.CARD_ACCP_ID
    <dynamic>
     <isNotNull prepend="and" property="memEmail">
       			 T1.MEM_EMAIL = #memEmail:VARCHAR#
     </isNotNull>
       <isNotNull prepend="and" property="memEmail">
       			 T4.MEM_EMAIL = #memEmail:VARCHAR#
     </isNotNull>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
</sqlMap>