<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CARDPINORDER" >
  <select id="selectCardPinOrderByDTO" parameterClass="com.huateng.accor.orderpin.dto.CardPinOrderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select T1.ORDER_CARD_PIN_ID as "orderCardPinId", 
    	   T1.ORDER_ID as "orderId", 
    	   T1.ORDER_NAME as "orderName", 
    	   T1.ISSURE_ID as "issureId", 
    	   T1.ORDER_STATE as "orderState", 
    	   T1.CREATE_USER as "createUser",
      	   T1.CREATE_TIME as "createTime", 
      	   T1.MODIFY_USER as "modifyUser", 
      	   T1.MODIFY_TIME as "modifyTime", 
      	   T1.DATE_STATE as "dateState",
		   T3.USER_NAME AS "userName",
		   T4.ISSUER_NAME AS "issuerName"
    from TB_ENT_CARD_PIN_ORDER T1,
		 TB_ENT_USER T3,
		 TB_ENT_ISSUER T4
    where
		T1.CREATE_USER = T3.USER_ID(+)
		AND T1.ISSURE_ID = T4.ISSUER_ID(+)
        AND T1.DATE_STATE = 1
    <dynamic>
    	<isNotNull prepend="and" property="defaultIssuerId">
			T1.ISSURE_ID = #defaultIssuerId:DECIMAL#
		</isNotNull>
		<isNotNull prepend="and" property="orderState">
			T1.ORDER_STATE = #orderState:DECIMAL#
		</isNotNull>
		<isNotNull prepend="and" property="createUser">
			T1.CREATE_USER = #createUser:DECIMAL#
		</isNotNull>
		<isNotEmpty prepend="and" property="orderName">
			UPPER(T1.ORDER_NAME) like UPPER('%'||#orderName:VARCHAR#||'%')
		</isNotEmpty>
		<isNotNull prepend="and" property="orderCardPinId">
			T1.ORDER_CARD_PIN_ID = #orderCardPinId:DECIMAL#
		</isNotNull>
		<isNotEmpty prepend="and" property="orderStateArray">
			T1.ORDER_STATE in ($orderStateArray$)
		</isNotEmpty>
	</dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
</sqlMap>