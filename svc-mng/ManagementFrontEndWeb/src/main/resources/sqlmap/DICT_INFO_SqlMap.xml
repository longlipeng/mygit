<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="DICTINFO">
  <select id="selectDictInfoByDTO" parameterClass="com.allinfinance.univer.system.dictinfo.dto.DictInfoQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
	select 
       T1.DICT_ID  as "dictId",
       T1.DICT_CODE  as "dictCode",
       T1.DICT_TYPE_CODE as "dictTypeCode",
       T2.DICT_TYPE_NAME as "dictTypeName",
       T1.DICT_NAME  as "dictName",
       T1.DICT_ENGLISH_NAME  as "dictEnglishName",
       DECODE(T2.UPDATE_FLAG,0,'不可编辑','可以编辑')  as "updateFlag",
       T2.UPDATE_FLAG      as "flag"
	   from  TB_DICT_INFO T1 left join 
       TB_DICT_TYPE T2 on    T1.DICT_TYPE_CODE=T2.DICT_TYPE_CODE
       where T1.DICT_STATE=1
    <dynamic>
    	<isNotEmpty prepend="and" property="dictId">
        			T1.DICT_ID=#dictId:DECIMAL#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictCode">
        			T1.DICT_CODE=#dictCode:DECIMAL#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictTypeName">
        			UPPER(T2.DICT_TYPE_NAME) like UPPER('%'||#dictTypeName:VARCHAR#||'%')
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictTypeCode">
        			T1.DICT_TYPE_CODE =#dictTypeCode:DECIMAL#
      	</isNotEmpty>
      	
      	<isNotEmpty prepend="and" property="dictName">
        			UPPER(T1.DICT_NAME) like UPPER('%'||#dictName:VARCHAR#||'%')
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictEnglishName">
        			UPPER(T1.DICT_ENGLISH_NAME) like UPPER('%'||#dictEnglishName:VARCHAR#||'%')
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="updateFlag">
        			T2.UPDATE_FLAG=#updateFlag:DECIMAL#
      	</isNotEmpty>
     	
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  
  <select id="selectEntityDictInfoByDTO" 
  		  parameterClass="com.allinfinance.univer.system.dictinfo.dto.EntityDictInfoQueryDTO" 
  		  resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
	select
       T1.DICT_ID  as "dictId",
       T1.DICT_CODE  as "dictCode",
       T1.DICT_TYPE_CODE as "dictTypeCode",
       T2.DICT_TYPE_NAME as "dictTypeName",
       T1.DICT_NAME  as "dictName",
       T1.DICT_ENGLISH_NAME  as "dictEnglishName",
       DECODE(T2.UPDATE_FLAG,0,'不可编辑','可以编辑')  as "updateFlag",
       T2.UPDATE_FLAG      as "flag"
	  from  TB_ENTITY_DICT_INFO T1 left join
	 	   TB_DICT_TYPE T2 on T1.DICT_TYPE_CODE=T2.DICT_TYPE_CODE
 	where T1.DICT_STATE=1
 	
 		AND	   T1.ENTITY_ID = #defaultEntityId:VARCHAR#

    <dynamic>
    	<isNotEmpty prepend="and" property="dictId">
        			T1.DICT_ID=#dictId:DECIMAL#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictCode">
        			T1.DICT_CODE=#dictCode:DECIMAL#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictTypeName">
        			UPPER(T2.DICT_TYPE_NAME) like UPPER('%'||#dictTypeName:VARCHAR#||'%')
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictTypeCode">
        			T1.DICT_TYPE_CODE =#dictTypeCode:DECIMAL#
      	</isNotEmpty>
      	
      	<isNotEmpty prepend="and" property="dictName">
        			UPPER(T1.DICT_NAME) like UPPER('%'||#dictName:VARCHAR#||'%')
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="dictEnglishName">
        			UPPER(T1.DICT_ENGLISH_NAME) like UPPER('%'||#dictEnglishName:VARCHAR#||'%')
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="updateFlag">
        			T2.UPDATE_FLAG=#updateFlag:DECIMAL#
      	</isNotEmpty>
     	
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  
  <insert id="insertEntityDictInfoFromDictInfo" parameterClass="java.lang.String">
       insert into tb_entity_dict_info
		  (DICT_ID,
		   DICT_CODE,
		   DICT_TYPE_CODE,
		   DICT_NAME,
		   DICT_SHORT_NAME,
		   DICT_ENGLISH_NAME,
		   DICT_STATE,
		   FATHER_DICT_CODE,
		   ENTITY_ID,
		   FATHER_ENTITY_ID
		   )
	   SELECT
	       SEQ_ENTITY_DICT_ID.NEXTVAL,
	       T.DICT_CODE,
	       T.DICT_TYPE_CODE,
	       T.DICT_NAME,
	       T.DICT_SHORT_NAME,
	       T.DICT_ENGLISH_NAME,
	       T.DICT_STATE,
	       T.FATHER_DICT_CODE,
	       #entityId:VARCHAR#,
	       '0'
	   FROM 
	       TB_DICT_INFO T
  </insert>
  
</sqlMap>