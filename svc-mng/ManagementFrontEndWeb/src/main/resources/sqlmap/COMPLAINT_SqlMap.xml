<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="COMPLAINT">
	<select id="selectComplaint" parameterClass="com.huateng.accor.phoneplace.dto.ComplaintQueryDTO" resultClass="java.util.HashMap"  remapResults="true">
		<include refid="Commons.prefixSql"/>
			select
				distinct
				T1.COMPLAINT_ID as "complaintId",
				T1.CARDHOLDER_CARD_NO as "cardholderCardNo",
				T1.CARDHOLDER_NAME as "cardholderName",
				T2.MERCHANT_NAME as "merchantName",
				T1.COMPLAINT_DATE as "complaintDate",
				T1.COMPLAINT_STATE as "complaintState",
				T3.USER_NAME as "modifyUser",
				T1.MODIFY_TIME as "modifyTime"
			from
				TB_ENT_COMPLAINT T1,
				TB_ENT_MERCHANT T2,
				TB_ENT_USER T3,
				TB_CARD_INFO T4,
				TB_ENT_CARDHOLDER T5
			where
				T1.MERCHANT_ID=T2.MERCHANT_ID(+)
			and
				T1.MODIFY_USER=T3.USER_ID
			and
				T1.CARDHOLDER_CARD_NO=T4.CARD_NO(+)
			
			and
				T1.DATA_STATE='1'
		<dynamic>
      		<isNotEmpty prepend="and" property="cardholderCardNo">
      		  T1.CARDHOLDER_CARD_NO = #cardholderCardNo:DECIMAL#
     		</isNotEmpty>
      		<isNotEmpty prepend="and" property="cardholderName">
      		
				T4.CARDHOLDER_ID=T5.CARDHOLDER_ID
			and
      		  T1.CARDHOLDER_NAME like '%'||#cardholderName:VARCHAR#||'%'
      		</isNotEmpty>
      		<isNotEmpty prepend="and" property="merchantId">
      	  	  T1.MERCHANT_ID = #merchantId:DECIMAL#
     		</isNotEmpty>
     		<isNotEmpty prepend="and" property="merchantName">
     		  T2.MERCHANT_NAME like '%'||#merchantName:VARCHAR#||'%'
     		</isNotEmpty>
     		<isNotEmpty prepend="and" property="complaintState">
     			T1.COMPLAINT_STATE =#complaintState:DECIMAL#
     		</isNotEmpty>
     		<isEqual prepend="and" property="defaultIssuerId" compareValue="0">
        		T2.ISSUER_GROUP_ID = #defaultIssuerGroupId:DECIMAL#
      		</isEqual>
      		<isNotEqual prepend="and" property="defaultIssuerId" compareValue="0">
       		 	T2.ISSUER_ID = #defaultIssuerId:DECIMAL#
      		</isNotEqual>
    	</dynamic>	
		<include refid="Commons.suffixSql"/>
	</select>
	
	<select id="selectdispute" parameterClass="com.huateng.accor.phoneplace.dto.ComplaintQueryDTO" resultClass="java.util.HashMap"  remapResults="true">
	<include refid="Commons.prefixSql"/>	
	SELECT T1.COMPLAINT_ID   as "complaintId",
       T1.CARDHOLDER_CARD_NO  as "cardNo",
       T1.CARDHOLDER_NAME    as "disputeName",
       T1.DISPUTE_TYPE       as "disputeType",
       T1.DISPUTE_LEVEL      as "disputeLevel",     
       to_char(T1.COMPLAINT_DATE,'yyyy-MM-dd')     as "disputeDate",
       T1.COMPLAINT_STATE     as "disputeResult",
       to_char(T1.FEEDBACK_DATE,'yyyy-MM-dd')    as "feedbackDate",
       T1.Dispute_Handler  as "disputeHandler" 
       FROM TB_ENT_COMPLAINT T1
	where 1=1
	<dynamic>	
		<isNotNull prepend="and"  property="complaintState" >			
			T1.COMPLAINT_STATE =#complaintState:DECIMAL#
		</isNotNull>
		
		<isNotNull prepend="and"  property="disputeType" >
				T1.DISPUTE_TYPE=#disputeType:DECIMAL#
		</isNotNull>	
		<isNotNull prepend="and"  property="merchantId" >
				T1.MERCHANT_ID=#merchantId:VARCHAR#
		</isNotNull>
		<isNotNull prepend="and" property="disputeStartDate" >
			<isNotNull property="disputeStopDate">
				trunc(T1.COMPLAINT_DATE) BETWEEN #disputeStartDate:DATE# 
				AND #disputeStopDate:DATE# 
			</isNotNull>
		</isNotNull>
	</dynamic>
		<include refid="Commons.suffixSql"/>
	
	</select>
	
</sqlMap>
