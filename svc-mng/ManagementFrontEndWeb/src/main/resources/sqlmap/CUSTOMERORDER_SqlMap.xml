<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CUSTOMERORDER">
	<select id="selectCustomerOrder" resultClass="java.util.HashMap"
		remapResults="true"
		parameterClass="com.huateng.accor.cardorder.dto.CustomerOrderQueryDTO">
		<include refid="Commons.prefixSql" />
		select 
			T1.ORDER_ID as "orderId",
			T1.CUSTOMER_ID as "customerId",
			T1.ORDER_TYPE as "orderType",
			T1.ORDER_DATE as "orderDate",
			T1.ISSUER_ID as "issuerId",
			T1.CREATE_USER as "createUser",
			T1.ORDER_STATE as "orderState",
			T2.CUSTOMER_NAME as "customerName",
			T3.USER_NAME AS "userName",
			T4.ISSUER_NAME AS "issuerName"
		from 
			TB_ENT_CUSTOMER_ORDER T1,
			TB_ENT_CUSTOMER T2,
			TB_ENT_USER T3,
			TB_ENT_ISSUER T4
		where 
			T1.DATA_STATE='1'
			AND T1.CUSTOMER_ID = T2.CUSTOMER_ID(+)
			AND T1.CREATE_USER = T3.USER_ID(+)
			AND T1.ISSUER_ID = T4.ISSUER_ID(+)
		<dynamic>
			<isNotNull prepend="and" property="defaultIssuerId">
				T1.ISSUER_ID = #defaultIssuerId:DECIMAL#
			</isNotNull>
			<isNotEmpty prepend="and" property="customerName">
				T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%'
			</isNotEmpty>
			<isNotNull prepend="and" property="orderState">
				T1.ORDER_STATE = #orderState:DECIMAL#
			</isNotNull>
			<isNotNull prepend="and" property="customerId">
				T1.CUSTOMER_ID = #customerId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="and" property="orderId">
				T1.ORDER_ID = #orderId:DECIMAL#
			</isNotNull>
			<isNotNull prepend="and" property="orderType">
				T1.ORDER_TYPE = #orderType:DECIMAL#
			</isNotNull>
			<isNotNull prepend="and" property="createUser">
				T1.CREATE_USER = #createUser:DECIMAL#
			</isNotNull>
			<isNotEmpty prepend="and" property="orderStateArray">
				T1.ORDER_STATE in ($orderStateArray$)
			</isNotEmpty>
		</dynamic>
		<include refid="Commons.suffixSql" />
	</select>
	<select id="getCustomerOrderById" resultClass="com.huateng.accor.cardorder.dto.CustomerOrderDTO" parameterClass="java.lang.Long" >
		SELECT 
			T.ORDER_ID             as orderId,
       		T.ORDER_TYPE           as orderType,
       		T.ORDER_DATE           as orderDate,
       		T.ORDER_BARCODE        as orderBarcode,
       		T.ISSUER_ID            as issuerId,
       		T3.ISSUER_NAME         as issuerName,
       		T.CUSTOMER_ID          as customerId,
       		T1.CUSTOMER_NAME       as customerName,
       		T.CARD_VALIDITY_PERIOD as cardValidityPeriod,
       		T.PRODUCT_ID           as productId,
       		T2.PRODUCT_NAME        as productName,
       		T.CARD_LAYOUT_ID       as cardLayoutId,
       		T4.CARD_NAME           as cardLayoutName,
       		T.PACKAGE_ID           as packageId,
       		T5.PACKAGE_NAME        as packageName,
       		T.PACKAGE_FEE          as packageFee,
       		T.MAKE_CARD_REASON     as makeCardReason,
       		T.CHANGE_CARD_FEE      as changeCardFee,
       		T.IS_INNER_DEDUCT      as isInnerDeduct,
       		T.CARD_ISSUE_FEE       as cardIssueFee,
       		T.ANNUAL_FEE           as annualFee,
       		T.DELIVERY_MEANS       as deliveryMeans,
       		T.DELIVERY_FEE         as deliveryFee,
       		T.DELIVERY_POINT       as deliveryPoint,
       		T6.DELIVERY_POINT_NAME as deliveryPointName,
       		T.ORDER_CONTACT        as orderContact,
       		T7.CONTACT_NAME        as orderContactName,
       		T.ORDER_PRIORITY       as orderPriority,
       		T.INVOICE_COMPANY_NAME as invoiceCompanyName,
       		T10.INVOICE_COMPANY_NAME as invoiceCompanyNameDis,
       		T.INVOICE_ADDRESSES    as invoiceAddresses,
       		T8.INVOICE_ADDRESS     as invoiceAddressDis,
       		T.INVOICE_ITEM         as invoiceItem,
       		T.INVOICE_DATE         as invoiceDate,
       		T.PAYMENT_TERM         as paymentTerm,
       		T.PAYMENT_DELAY        as paymentDelay,
       		T.PAYMENT_STATE        as paymentState,
       		T.PAYMENT_DATE         as paymentDate,
       		T.DISCOUNT_FEE         as discountFee,
       		T.ADDITIONAL_FEE       as additionalFee,
       		T.TOTAL_PRICE          as totalPrice,
       		T.ORDER_STATE          as orderState,
       		T.ORDER_SOURCE         as orderSource,
       		T.REF_ORDER            as refOrder,
       		T.EXTERNAL_ID          as externalId,
       		T.MEMO                 as memo,
       		T.ORDER_INFO           as orderInfo,
       		T.ACC_TYPE_ID          as accTypeId,
       		T9.ACC_TYPE_NAME       as accTypeName,
       		T.SERVICE_FEE          as serviceFee,
       		T.FORECAST_CREDIT_DATE as forecastCreditDate,
       		T.REAL_CREDIT_DATE     as realCreditDate,
       		T.CARD_QUANTITY        as cardQuantity,
       		T.REAL_CARD_QUANTITY   as realCardQuantity,
       		T.CARD_COMPANY_ID      as cardCompanyId,
       		T.CREATE_USER          as createUser,
       		T11.USER_NAME          as createUserName,
       		T.CREATE_TIME          as createTime,
       		T.MODIFY_USER          as modifyUser,
       		T.MODIFY_TIME          as modifyTime,
       		T.DATA_STATE           as dataState,
       		T.FACE_VALUE_TYPE      as faceValueType,
       		T.FACE_VALUE           as faceValue,
       		T.CARD_TYPE            as cardType
  		FROM 
  			TB_ENT_CUSTOMER_ORDER T,
       		TB_ENT_CUSTOMER T1,
       		TB_ENT_PRODUCT T2,
       		TB_ENT_ACCTYPE T9,
       		TB_ENT_ISSUER  T3,
       		TB_ENT_CARD_LAYOUT T4,
       		TB_ENT_PACKAGE     T5,
       		TB_ENT_DELIVERY_POINT T6,
       		TB_ENT_CONTACT     T7,
       		TB_ENT_INVOICE_ADDRESS T8,
       		TB_ENT_INVOICE_COMPANY T10,
       		TB_ENT_USER            T11
  		WHERE 
  			  T.CUSTOMER_ID=T1.CUSTOMER_ID(+)
  		AND   T.PRODUCT_ID=T2.PRODUCT_ID(+)
  		AND   T.ACC_TYPE_ID=T9.ACC_TYPE_ID(+)
  		AND   T.ISSUER_ID=T3.ISSUER_ID(+)
  		AND   T.CARD_LAYOUT_ID=T4.CARD_LAYOUT_ID(+)
  		AND   T.PACKAGE_ID=T5.PACKAGE_ID(+)
  		AND   T.DELIVERY_POINT=T6.DELIVERY_POINT_ID(+)
  		AND   T.ORDER_CONTACT=T7.CONTACT_ID(+)
  		AND   T.INVOICE_ADDRESSES=T8.INVOICE_ADDRESS_ID(+)
  		AND   T.INVOICE_COMPANY_NAME=T10.INVOICE_COMPANY_ID(+)
  		AND   T.CREATE_USER=T11.USER_ID(+)
  		AND   T.ORDER_ID=#orderId#

		
	</select>
</sqlMap>
