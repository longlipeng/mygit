<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="PAYMENT_MODIFY" >
    <select id="inqueryOrder" parameterClass="com.huateng.accor.cardorder.dto.CustomerOrderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
        <include refid="Commons.prefixSql" />
        select
            T1.ORDER_ID as "orderId",
            T1.CUSTOMER_ID as "customerId",
            T1.ORDER_TYPE as "orderType",
            T1.ORDER_DATE as "orderDate",
            T1.ISSUER_ID as "issuerId",
            T1.CREATE_USER as "createUser",
            T1.ORDER_STATE as "orderState",
            T2.CUSTOMER_NAME as "customerName",
            T3.USER_NAME AS "userName",
            T4.ISSUER_NAME AS "issuerName"
        from
            TB_ENT_CUSTOMER_ORDER T1,
            TB_ENT_CUSTOMER T2,
            TB_ENT_USER T3,
            TB_ENT_ISSUER T4
        where
            T1.DATA_STATE='1'
            and T1.CUSTOMER_ID = T2.CUSTOMER_ID(+)
            and T1.CREATE_USER = T3.USER_ID(+)
            and T1.ISSUER_ID = T4.ISSUER_ID(+)

            <!-- 订单类型为充值卡订单、充值订单、礼品卡销售订单 -->
            and T1.ORDER_TYPE in (1, 2, 4)

            <!-- 订单状态不是取消 -->
            and T1.ORDER_STATE != 0

            <!-- 订单支付状态是未支付 -->
            and T1.PAYMENT_STATE = 0
            <dynamic>
                <isNotNull prepend="and" property="defaultIssuerId">
                    T1.ISSUER_ID = #defaultIssuerId:DECIMAL#
                </isNotNull>
                <isNotEmpty prepend="and" property="customerName">
                    T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%'
                </isNotEmpty>
                <isNotNull prepend="and" property="customerId">
                    T1.CUSTOMER_ID = #customerId:DECIMAL#
                </isNotNull>
                <isNotNull prepend="and" property="orderId">
                    T1.ORDER_ID = #orderId:DECIMAL#
                </isNotNull>
                <isNotNull prepend="and" property="orderType">
                    T1.ORDER_TYPE = #orderType:DECIMAL#
                </isNotNull>
                <isNotNull prepend="and" property="createUser">
                    T1.CREATE_USER = #createUser:DECIMAL#
                </isNotNull>
            </dynamic>
        <include refid="Commons.suffixSql" />
    </select>
</sqlMap>