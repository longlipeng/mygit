<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="CARDHOLDER" >
<select id="selectCardholdersByDTO" parameterClass="com.allinfinance.univer.seller.cardholder.dto.CardholderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
        T1.CARDHOLDER_ID as "cardholderId",
        T1.MEMBER_ID as "memberId",
        T1.FIRST_NAME as "firstName",
        T1.EXTERNAL_ID as "externalId",
        T1.CARDHOLDER_MOBILE as "cardholderMobile",
        T1.CARDHOLDER_SEGMENT as "cardholderSegment",
        T1.CARDHOLDER_STATE as "cardholderState",
        T1.DEPARTMENT_ID as "departmentId",
        T1.CHECK_STATE as "checkState",
        T2.CUSTOMER_NAME as "customerName",
        T3.DEPARTMENT_NAME as "departmentName"
    from
        TB_CARDHOLDER T1 left join TB_ENTITY_DEPARTMENT T3 on T1.DEPARTMENT_ID = T3.DEPARTMENT_ID,
        TB_CUSTOMER T2    
    where
        T1.ENTITY_ID = T2.ENTITY_ID
        and T1.DATA_STATE = '1'
        and T2.DATA_STATE = '1' 
    <dynamic>
      <isNotEmpty prepend="and" property="defaultEntityId">
        T2.FATHER_ENTITY_ID = #defaultEntityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="entityId">
        T1.ENTITY_ID = #entityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="customerName">
        T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="externalId">
        T1.EXTERNAL_ID = #externalId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderId">
        T1.CARDHOLDER_ID = #cardholderId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        T1.FIRST_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        T1.CARDHOLDER_MOBILE = #cardholderMobile:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderSegment">
        T1.CARDHOLDER_SEGMENT = #cardholderSegment:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderState">
        T1.CARDHOLDER_STATE = #cardholderState:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="idNo">
        T1.ID_NO = #idNo:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="idType">
        T1.ID_TYPE = #idType:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="checkState">
        T1.CHECK_STATE = #checkState:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardNo">
        T1.CARDHOLDER_ID in (
                     SELECT 
      cardList.Cardholder_Id
     from TB_SELL_ORDER_CARD_LIST cardList,tb_sell_order orde
      where 
      orde.order_id=cardList.Order_Id
       and orde.order_type !='10000003'
  		and cardList.data_state='1'
  		and cardList.card_no  is not null 
      and cardList.Card_No like '%'||#cardNo:VARCHAR#||'%'
        )
      </isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  
  <select id="selectCardholdersByCheckState" parameterClass="com.allinfinance.univer.seller.cardholder.dto.CardholderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
        T1.CARDHOLDER_ID as "cardholderId",
        T1.MEMBER_ID as "memberId",
        T1.FIRST_NAME as "firstName",
        T1.CARDHOLDER_MOBILE as "cardholderMobile",
        T1.CARDHOLDER_STATE as "cardholderState",
        T1.DEPARTMENT_ID as "departmentId",
        T1.CHECK_STATE as "checkState",
        T2.CUSTOMER_NAME as "customerName",
        T3.DEPARTMENT_NAME as "departmentName",
       '个人持卡人' as "customerType",
        T1.ISBLACKLIST as "isblacklist",
    	T1.RISK_GRADE  as "riskGrade"        
    from
        TB_CARDHOLDER_VERIFY T1 left join TB_ENTITY_DEPARTMENT T3 on T1.DEPARTMENT_ID = T3.DEPARTMENT_ID,
        TB_CUSTOMER T2    
    where
        T1.ENTITY_ID = T2.ENTITY_ID
        and T1.DATA_STATE = '1'
        and T2.DATA_STATE = '1'
        and T1.CHECK_STATE != '1'
    <dynamic>
      <isNotEmpty prepend="and" property="defaultEntityId">
       T2.FATHER_ENTITY_ID = #defaultEntityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="entityId">
        T1.ENTITY_ID = #entityId:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="customerName">
        T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%' 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderId">
        T1.CARDHOLDER_ID = #cardholderId:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        T1.FIRST_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        T1.CARDHOLDER_MOBILE = #cardholderMobile:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderState">
        T1.CARDHOLDER_STATE = #cardholderState:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="checkState">
        T1.CHECK_STATE = #checkState:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="idNo">
       T1.ID_NO = #idNo:VARCHAR#
      </isNotEmpty> 
    </dynamic>  
        UNION All
    select
        T4.RELATION_NO as "cardholderId",
        '' as "memberId",
        T4.COMPANY_NAME as "firstName",
        T4.CORP_TELEPHONE_NUMBER as "cardholderMobile",
        T4.CUS_STATE as "cardholderState",
        '' as "departmentId",
        T4.VERIFY_STAT as "checkState",
        T2.CUSTOMER_NAME as "customerName",
        '' as "departmentName",
        '企业持卡人' as "customerType",
        T4.ISBLACKLIST as "isblacklist",
    	T4.RISK_GRADE  as "riskGrade"
    from
        TB_COMPANY_INFO T4 left join TB_CUSTOMER T2 on T4.ENTITY_ID = T2.ENTITY_ID
    where 
        T4.RELATION_TYPE = '01' 
        and T4.VERIFY_STAT != '1'
        and T4.DATA_STATE = '1' 
        and T4.RELATION_TYPE='01'
     <dynamic>
      <isNotEmpty prepend="and" property="entityId">
        T4.ENTITY_ID = #entityId:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="customerName">
        T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%' 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderState">
        T4.CUS_STATE = #cardholderState:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderId">
        T4.RELATION_NO = #cardholderId:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        T4.COMPANY_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        T4.CORP_TELEPHONE_NUMBER = #cardholderMobile:VARCHAR# 
      </isNotEmpty>      
      <isNotEmpty prepend="and" property="checkState">
        T4.VERIFY_STAT = #checkState:VARCHAR# 
      </isNotEmpty> 
      <isNotEmpty prepend="and" property="idNo">
        T4.CORP_CRED_ID = #idNo:VARCHAR#
      </isNotEmpty> 
    </dynamic>       
    <include refid="Commons.suffixSql"/>
  </select>
<!--  
 <select id="selectCardholdersWithOrderListByDTO" parameterClass="com.huateng.univer.seller.cardholder.dto.CardholderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
        select
            T1.CARDHOLDER_ID as "cardholderId",
            T1.CARDHOLDER_NAME as "cardholderName",
            T1.EXTERNAL_ID as "externalId",
            T2.CUSTOMER_NAME as "customerName",
            T1.MOBILE as "mobile",
            T1.SEGMENT as "segment",
            T1.STATE as "state",
            T1.DEPARTMENT_ID as "departmentId",
            T3.DEPARTMENT_NAME as "departmentName"
        from
            TB_ENT_CARDHOLDER T1,
            TB_ENT_CUSTOMER T2,
            TB_ENT_DEPARTMENT T3
        where
            T1.CUSTOMER_ID = T2.CUSTOMER_ID
            and T1.DATA_STATE = 1
            and T2.DATA_STATE = 1
            and T1.DEPARTMENT_ID = T3.DEPARTMENT_ID(+)
            and T1.CARDHOLDER_ID not in (select CARDHOLDER_ID from TB_ENT_ORDER_LIST
                                             where ORDER_ID = #orderId:VARCHAR# and DATA_STATE = 1)
        <dynamic>
          <isNotEmpty prepend="and" property="customerId">
            T1.CUSTOMER_ID = #customerId:VARCHAR#
          </isNotEmpty>
          <isNotEmpty prepend="and" property="customerName">
            T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="externalId">
            T1.EXTERNAL_ID = #externalId:VARCHAR#
          </isNotEmpty>
          <isNotEmpty prepend="and" property="cardholderId">
            T1.CARDHOLDER_ID = #cardholderId:VARCHAR#
          </isNotEmpty>
          <isNotEmpty prepend="and" property="cardholderName">
            T1.CARDHOLDER_NAME like '%'||#cardholderName:VARCHAR#||'%'
          </isNotEmpty>
          <isNotEmpty prepend="and" property="mobile">
            T1.MOBILE = #mobile:VARCHAR#
          </isNotEmpty>
          <isNotEmpty prepend="and" property="segment">
            T1.SEGMENT = #segment:VARCHAR#
          </isNotEmpty>
          <isNotEmpty prepend="and" property="departmentId">
            T1.DEPARTMENT_ID = #departmentId:VARCHAR#
          </isNotEmpty>
          <isNotEmpty prepend="and" property="state">
            T1.STATE = #state:VARCHAR#
          </isNotEmpty>
        </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  -->
  <select id="isExistCustomerByCardholderDTO" parameterClass="com.allinfinance.univer.seller.cardholder.dto.CardholderDTO" resultClass="java.lang.Integer">

        select 
        	count(*) 
        from 
            TB_CARDHOLDER T0,
            TB_CARDHOLDER_CARDLIST T1
        where 
            T0.CARDHOLDER_ID = T1.CARDHOLDER_ID
        and 
        	T1.CARDHOLDER_ID = #cardholderId:VARCHAR#
        and 
        	T1.PRODUCT_ID not in(
          select 
          		distinct t2.product_id  
          from 
          		TB_SELL_PROD_CONTRACT t2
          where t2.sell_contract_id in (
               select 
               		t3.sell_contract_id 
               from 
               		tb_sell_contract t3 
               where 
               		t3.contract_buyer = #entityId:VARCHAR#
               and  t3.EXPIRY_DATE &gt;=SYSDATE
               and  t3.DATA_STATE = '1'
          )
        )
        
  </select>
<select id="selectCardholders" parameterClass="com.allinfinance.univer.seller.cardholder.dto.CardholderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select   
        T1.CARDHOLDER_ID as "cardholderId",
        T1.MEMBER_ID as "memberId",
        T1.FIRST_NAME as "firstName",
        T1.ID_TYPE as "idType",
        T1.ID_NO as "idNo",
        T1.EXTERNAL_ID as "externalId",
        T1.CARDHOLDER_MOBILE as "cardholderMobile",
        T1.CARDHOLDER_SEGMENT as "cardholderSegment",
        T1.CARDHOLDER_STATE as "cardholderState",
        T1.DEPARTMENT_ID as "departmentId"
    from
        TB_CARDHOLDER T1
    where 1=1 
    <dynamic>
      <isNotEmpty prepend="and" property="entityId">
        T1.ENTITY_ID = #entityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="externalId">
        T1.EXTERNAL_ID = #externalId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderId">
        T1.CARDHOLDER_ID = #cardholderId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        T1.FIRST_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        T1.CARDHOLDER_MOBILE = #cardholderMobile:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderSegment">
        T1.CARDHOLDER_SEGMENT = #cardholderSegment:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderState">
        T1.CARDHOLDER_STATE = #cardholderState:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardNo">
        T1.CARDHOLDER_ID in (
            SELECT 
      cardList.Cardholder_Id
      from  TB_SELL_ORDER_CARD_LIST cardList,tb_sell_order orde
      where 
      orde.order_id=cardList.Order_Id
       and orde.order_type !='10000003'
  		and cardList.data_state='1'
  		and cardList.card_no  is not null 
      and cardList.Card_No=#cardNo:VARCHAR#
        )
      </isNotEmpty>
    </dynamic>
    UNION ALL
     select   
        T.RELATION_NO as "cardholderId",
        '' as "memberId",
        T.COMPANY_NAME as "firstName",
        T.COMPANY_ID_TYPE as "idType",
        T.COMPANY_ID as "idNo",
        '' as "externalId",
        T.LINKPHONE as "cardholderMobile",
        '' as "cardholderSegment",
        T.CUS_STATE as "cardholderState",
        '' as "departmentId"
    from
        TB_COMPANY_INFO T
    WHERE
    1=1
    <dynamic>
      <isNotEmpty prepend="and" property="entityId">
        T.ENTITY_ID = #entityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderId">
        T.RELATION_NO = #cardholderId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        T.COMPANY_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        T.LINKPHONE = #cardholderMobile:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderState">
        T.CUS_STATE = #cardholderState:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardNo">
        T.CARDHOLDER_ID in (
            SELECT 
      cardList.Cardholder_Id
      from  TB_SELL_ORDER_CARD_LIST cardList,tb_sell_order orde
      where 
      orde.order_id=cardList.Order_Id
       and orde.order_type !='10000003'
  		and cardList.data_state='1'
  		and cardList.card_no  is not null 
      and cardList.Card_No=#cardNo:VARCHAR#
        )
      </isNotEmpty>
    </dynamic>
    
    
    <include refid="Commons.suffixSql"/>
  </select>

<!--*******************************新增*************************************** -->
<select id="selectCardholdersByCardholderDTO" parameterClass="com.allinfinance.univer.seller.cardholder.dto.CardholderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
        T1.CARDHOLDER_ID as "cardholderId",
        T1.MEMBER_ID as "memberId",
        T1.FIRST_NAME as "firstName",
        T1.EXTERNAL_ID as "externalId",
        T1.CARDHOLDER_MOBILE as "cardholderMobile",
        T1.CARDHOLDER_SEGMENT as "cardholderSegment",
        T1.CARDHOLDER_STATE as "cardholderState",
        T1.DEPARTMENT_ID as "departmentId",
        T1.CHECK_STATE as "checkState",
        T2.CUSTOMER_NAME as "customerName",
        T3.DEPARTMENT_NAME as "departmentName",
        '个人持卡人' as "customerType",
        T4.ISBLACKLIST as "isblacklist",
    	T4.RISK_GRADE  as "riskGrade"
    from
        TB_CARDHOLDER T1 left join TB_PEOPLE_ATTACH_INFO T4 on T1.CARDHOLDER_ID = T4.PEOPLE_NO
        left join TB_ENTITY_DEPARTMENT T3 on T1.DEPARTMENT_ID = T3.DEPARTMENT_ID,
        TB_CUSTOMER T2    
    where
        T1.ENTITY_ID = T2.ENTITY_ID
        and T1.DATA_STATE = '1'
        and T2.DATA_STATE = '1' 
    <dynamic>
      <isNotEmpty prepend="and" property="defaultEntityId">
        T2.FATHER_ENTITY_ID = #defaultEntityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="entityId">
        T1.ENTITY_ID = #entityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="customerName">
        T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderId">
        T1.CARDHOLDER_ID = #cardholderId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        T1.FIRST_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        T1.CARDHOLDER_MOBILE = #cardholderMobile:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderState">
        T1.CARDHOLDER_STATE = #cardholderState:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="idNo">
        T1.ID_NO = #idNo:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="idType">
        T1.ID_TYPE = #idType:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="checkState">
        T1.CHECK_STATE = #checkState:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardNo">
        T1.CARDHOLDER_ID in (
                     SELECT 
      cardList.Cardholder_Id
     from TB_SELL_ORDER_CARD_LIST cardList,tb_sell_order orde
      where 
      orde.order_id=cardList.Order_Id
       and orde.order_type !='10000003'
  		and cardList.data_state='1'
  		and cardList.card_no  is not null 
      and cardList.Card_No like '%'||#cardNo:VARCHAR#||'%')
      </isNotEmpty>
    </dynamic>
    UNION All
    select
        T4.RELATION_NO as "cardholderId",
        '' as "memberId",
        T4.COMPANY_NAME as "firstName",
        '' as "externalId",
        T4.CORP_TELEPHONE_NUMBER as "cardholderMobile",
        '' as "cardholderSegment",
        T4.CUS_STATE as "cardholderState",
        '' as "departmentId",
        T4.VERIFY_STAT as "checkState",
        T2.CUSTOMER_NAME as "customerName",
        '' as "departmentName",
        '企业持卡人' as "customerType",
        T4.ISBLACKLIST as "isblacklist",
    	T4.RISK_GRADE  as "riskGrade"
    from
        TB_COMPANY_INFO T4 left join TB_CUSTOMER T2 on T4.ENTITY_ID = T2.ENTITY_ID
    where 
        T4.VERIFY_STAT = '1'
    and T4.DATA_STATE = '1'
    and T4.RELATION_TYPE='01'
     <dynamic>
      <isNotEmpty prepend="and" property="entityId">
        T4.ENTITY_ID = #entityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="customerName">
        T2.CUSTOMER_NAME like '%'||#customerName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderState">
        T4.CUS_STATE = #cardholderState:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderId">
        T4.RELATION_NO = #cardholderId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        T4.COMPANY_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        T4.CORP_TELEPHONE_NUMBER = #cardholderMobile:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="idNo">
        T4.CORP_CRED_ID = #idNo:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="idType">
        T4.CORP_CRED_TYPE = #idType:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="checkState">
        T4.VERIFY_STAT = #checkState:VARCHAR# 
      </isNotEmpty> 
      <isNotEmpty prepend="and" property="cardNo">
        T4.RELATION_NO in (
                     SELECT 
      cardList.Cardholder_Id
     from TB_SELL_ORDER_CARD_LIST cardList,tb_sell_order orde
      where 
      orde.order_id=cardList.Order_Id
       and orde.order_type !='10000003'
  		and cardList.data_state='1'
  		and cardList.card_no  is not null 
      and cardList.Card_No like '%'||#cardNo:VARCHAR#||'%')
      </isNotEmpty>
    </dynamic>       
    <include refid="Commons.suffixSql"/>
  </select>

<select id="selectCustomerByIdNo" parameterClass="com.allinfinance.univer.seller.cardholder.dto.CardholderQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    SELECT
        T1.ID_NO AS "customerIdNo", T2.FIRST_NAME AS "customerName",
        T1.UNIQUE_ID AS "customerId", T1.CUSTOMER_ID AS "entityId",
        T1.TYPE AS "customerType", '2' as "cusType"
	FROM
		SVC_MNG.TB_UNIQUE_USER_ID T1 LEFT JOIN SVC_MNG.TB_CARDHOLDER T2 ON T1.CARD_HOLDER_ID=T2.CARDHOLDER_ID
	WHERE 
		T1.CARD_HOLDER_ID IS NOT NULL AND T1.TYPE='1'	
	<dynamic>
      <isNotEmpty prepend="and" property="idNo">
       T1.ID_NO = #idNo:VARCHAR#
      </isNotEmpty>
    </dynamic>	
    
	UNION 
		
	SELECT
		T1.ID_NO AS "customerIdNo", T3.COMPANY_NAME AS "customerName",
		T1.UNIQUE_ID AS "customerId", T1.CUSTOMER_ID AS "entityId",
		T1.TYPE AS "customerType", '2' as "cusType"
	FROM
		SVC_MNG.TB_UNIQUE_USER_ID T1 LEFT JOIN SVC_MNG.TB_COMPANY_INFO T3 ON T1.CARD_HOLDER_ID=T3.RELATION_NO 
	WHERE 
		T1.CARD_HOLDER_ID IS NOT NULL AND T1.TYPE='2' AND T3.RELATION_TYPE='01'	
	<dynamic>
      <isNotEmpty prepend="and" property="idNo">
       T1.ID_NO = #idNo:VARCHAR#
      </isNotEmpty>
    </dynamic>	
	UNION 
	
	SELECT	
        T1.ID_NO AS "customerIdNo", T3.COMPANY_NAME AS "customerName",
        T1.UNIQUE_ID AS "customerId", T1.CUSTOMER_ID AS "entityId",
        T1.TYPE AS "customerType", '1' as "cusType"
	FROM
		SVC_MNG.TB_UNIQUE_USER_ID T1 LEFT JOIN SVC_MNG.TB_COMPANY_INFO T3 ON T1.CUSTOMER_ID=T3.RELATION_NO 
	WHERE 
		T1.CARD_HOLDER_ID IS NULL AND T1.TYPE='2' AND T3.RELATION_TYPE='00'
	<dynamic>
      <isNotEmpty prepend="and" property="idNo">
       T1.ID_NO = #idNo:VARCHAR#
      </isNotEmpty>
    </dynamic>
	UNION 
	
	SELECT
		T1.ID_NO AS "customerIdNo", T4.CUSTOMER_NAME AS "customerName",
		T1.UNIQUE_ID AS "customerId", T1.CUSTOMER_ID AS "entityId",
		T1.TYPE AS "customerType", '1' as "cusType"
	FROM
		SVC_MNG.TB_UNIQUE_USER_ID T1 LEFT JOIN SVC_MNG.TB_CUSTOMER T4 ON T1.CUSTOMER_ID=T4.ENTITY_ID 
	WHERE 
		T1.CARD_HOLDER_ID IS NULL AND T1.TYPE='1' 
    <dynamic>
      <isNotEmpty prepend="and" property="idNo">
       T1.ID_NO = #idNo:VARCHAR#
      </isNotEmpty>
    </dynamic>      
    <include refid="Commons.suffixSql"/>
  </select>
  
  <select id="selectInformationAudit" parameterClass="com.allinfinance.univer.seller.cardholder.dto.PictureInfoQueryDTO"  resultClass="java.util.HashMap"  remapResults="true" >
  	 <include refid="Commons.prefixSql"/>
	  select   
	    t.CARD_NO as "cardNo",
	      c.CARDHOLDER_ID as "cardholderId",
	      c.FIRST_NAME as "firstName",
	      t.PEOPLE_NO as "idNo",
	      c.CARDHOLDER_MOBILE as "cardholderMobile",
    	  decode(t.CHECK_STATE,'0','未审核','1','通过','2','未通过') as "auditState",
    	  TO_DATE(t.CREATE_TIME,'yyyy-MM-dd hh24miss') as "createTime"
	    from TB_CHECK_PEOPLE_INFO t 
	      inner join TB_CARDHOLDER c on t.PEOPLE_NO=c.ID_NO
	    where t.DATA_STATE=1
    <dynamic>
      <isNotEmpty prepend="and" property="cardholderId">
        c.CARDHOLDER_ID = #cardholderId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="firstName">
        c.FIRST_NAME like '%'||#firstName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="cardholderMobile">
        c.CARDHOLDER_MOBILE = #cardholderMobile:VARCHAR# 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="idNo">
        c.ID_NO = #idNo:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="idType">
        c.ID_TYPE = #idType:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="cardNo">
        t.CARD_NO = #cardNo:VARCHAR#
       </isNotEmpty>
		<isNotEmpty prepend="and" property="startTime" >
			to_date(substr(t.CREATE_TIME,1,8),
				'yyyy-MM-dd')>=to_date(#startTime:DATE#,'yyyy-MM-dd')
		</isNotEmpty>
		<isNotEmpty prepend="and" property="endTime" >
		<![CDATA[ 
			to_date(substr(t.CREATE_TIME,1,8),
				'yyyy-MM-dd')<=to_date(#endTime:DATE#,'yyyy-MM-dd')
			]]>
		</isNotEmpty>
       <isNotEmpty prepend="and" property="auditState">
        t.CHECK_STATE = #auditState:VARCHAR#
       </isNotEmpty>
    </dynamic>  
    order by  t.CREATE_TIME desc
   <include refid="Commons.suffixSql"/>
  </select>
</sqlMap>