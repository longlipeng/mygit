<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TB_ACC_CARD_INFO">
<resultMap id="abatorgenerated_TbAccCardInfo" class="com.allinfinance.univer.cardmanagement.dto.BatchCardInfoDTO">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Aug 06 10:52:07 CST 2013.
    -->
    <result column="CARD_NO" jdbcType="VARCHAR" property="cardNo" />
    <result column="PRODUCT_ID" jdbcType="VARCHAR" property="productId" />
    <result column="ISSUER_ID" jdbcType="VARCHAR" property="issuerId" />
  </resultMap>
  <sql id="abatorgenerated_Example_Where_Clause" >
    
    
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
<select id="selectBatchCardDTO" parameterClass="com.allinfinance.univer.cardmanagement.dto.BatchCardActionDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
         T1.CARD_NO as "cardNo",
        decode(T1.CARD_STAT,'0','未激活','1','已激活') as "activable",
        decode(T1.CARD_STAT,'0','允许','1','不允许') as "allowable"
    from
        TB_ACC_CARD_INFO T1
    where T1.CARD_NO &gt;=to_number(#startCardNo:VARCHAR#)
    and T1.CARD_NO &lt;=to_number(#endCardNo:VARCHAR#)
    and T1.ISSUER_ID=#issuerId:VARCHAR#
    and T1.CARD_STAT IN ('0','1')
    <include refid="Commons.suffixSql"/>
  </select>
  <select id="selectBatchCardInfo" resultMap="abatorgenerated_TbAccCardInfo"  parameterClass="com.allinfinance.univer.cardmanagement.dto.BatchCardActionDTO" >
    select
         CARD_NO,
         PRODUCT_ID,
         ISSUER_ID
    from
        TB_ACC_CARD_INFO
    where  ISSUER_ID=#issuerId:VARCHAR#
    and CARD_STAT IN ('0','1')
    AND CARD_NO IN (<iterate property="cardNoArray" conjunction="," >
          		$cardNoArray[]$</iterate>)
  </select>
  <select id="selectBatchCardInfoBySell" resultMap="abatorgenerated_TbAccCardInfo"  parameterClass="com.allinfinance.univer.cardmanagement.dto.BatchCardActionDTO" >
    select
         CARD_NO,
         PRODUCT_ID,
         ISSUER_ID
    from
        TB_ACC_CARD_INFO
    where CARD_STAT IN ('0','1')
    AND CARD_NO IN (<iterate property="cardNoArray" conjunction="," >
          		$cardNoArray[]$</iterate>)
  </select>
  <select id="selectCardNOStatus" parameterClass="com.allinfinance.univer.cardmanagement.dto.BatchCardActionDTO" resultClass="java.lang.Long" remapResults="true">
    select
         count(card_no)
    from
        TB_ACC_CARD_INFO T1
    where T1.CARD_STAT!='0'
    and T1.ISSUER_ID=#issuerId:VARCHAR#
    AND CARD_NO IN (<iterate property="cardNoArray" conjunction="," >
          		$cardNoArray[]$</iterate>)
  </select>
  <select id="selectCardNOProductId" parameterClass="com.allinfinance.univer.cardmanagement.dto.BatchCardActionDTO" resultClass="java.lang.Integer" remapResults="true">
    select
         count(distinct product_id)
    from
        TB_ACC_CARD_INFO T1
    where T1.CARD_STAT='0'
    and T1.ISSUER_ID=#issuerId:VARCHAR#
    AND T1.CARD_NO IN (<iterate property="cardNoArray" conjunction="," >
          		$cardNoArray[]$</iterate>)
  </select>
  <update id="updateStatus" parameterClass="com.allinfinance.univer.cardmanagement.dto.BatchCardActionDTO" >
    update 
         TB_ACC_CARD_INFO
    set
         CARD_STAT='2'
    where CARD_STAT='0'
    and ISSUER_ID=#issuerId:VARCHAR#
    AND CARD_NO IN (<iterate property="cardNoArray" conjunction="," >
          		$cardNoArray[]$</iterate>)
  </update>
   <update id="updateStatusBySeller" parameterClass="com.allinfinance.univer.cardmanagement.dto.BatchCardActionDTO" >
    update 
         TB_ACC_CARD_INFO
    set
         CARD_STAT='2'
    where CARD_STAT='0'
    AND CARD_NO IN (<iterate property="cardNoArray" conjunction="," >
          		$cardNoArray[]$</iterate>)
  </update>
<!--  <select id="abatorgenerated_countByExample" parameterClass="com.huateng.framework.ibatis.dao.AccCardInfoExample" resultClass="java.lang.Integer">-->
<!--    -->
<!--      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.-->
<!--      This element was generated on Tue Aug 06 10:52:07 CST 2013.-->
<!--    -->
<!--    select count(*) from TB_ACC_CARD_INFO-->
<!--    where CARD_STAT IN('0','1')-->
<!--    and T1.ISSUER_ID=#issuerId:VARCHAR#-->
<!--    <include refid="TB_ACC_CARD_INFO.abatorgenerated_Example_Where_Clause" />-->
<!--  </select>-->
<!--  <select id="abatorgenerated_selectByExample" parameterClass="com.huateng.framework.ibatis.dao.AccCardInfoExample" resultMap="abatorgenerated_TblSapInfoResult">-->
<!--    -->
<!--      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.-->
<!--      This element was generated on Tue Aug 06 10:52:07 CST 2013.-->
<!--    -->
<!--    select ID, TRANS_TYPE, TRANS_SEQ, TRANS_DT, TRANS_COMPANY, PAYMENT, AMOUNT, RATE_AMOUNT,-->
<!--      RE_AMOUNT, VENDOR, SALE_COMPANY, SERVICE_TYPE, SERVICE_SUBTYPE, PUB_PVT_INT_FLAG, DOC_NO,-->
<!--      CURRENCY_CODE, PAYMT_TYPE, PAYMT_FLAG, REMK1, REMK2, REMK3, REMK4, REMK5, REMK6, REMK7, REMK8,-->
<!--      NEED_RECEIPT, FLAG, CREATED_TIME, UPDATED_TIME-->
<!--    from TBL_SAP_INFO-->
<!--    <isParameterPresent>-->
<!--      <include refid="TB_ACC_CARD_INFO.abatorgenerated_Example_Where_Clause" />-->
<!--      <isNotNull property="orderByClause">-->
<!--        order by $orderByClause$-->
<!--      </isNotNull>-->
<!--    </isParameterPresent>-->
<!--  </select>-->
<select id="selectQueryPin"   parameterClass="com.allinfinance.univer.cardmanagement.dto.CardManagementDTO" resultClass="java.lang.String">
	select query_pin as "QueryPin" from tb_acc_card_info where card_no=#cardNo:varchar#
</select>
<update id="updateTxnPin" parameterClass="com.allinfinance.univer.cardmanagement.dto.CardManagementDTO">
	update tb_acc_card_info set TXN_PIN=#password:varchar# where card_no=#cardNo:varchar#
</update>
</sqlMap>