<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TXN_REFUND">
  <select id="selectTxnRefund" parameterClass="com.huateng.accor.txnrefund.dto.TxnRefundQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
      T1.SYS_SEQ_NUM as "sysSeqNum",
      T1.MCHNT_ID as "mchntId",
      T1.CARD_NO as "cardNo",
      to_char(to_date(decode(T1.TXN_DATE, 0, null, T1.TXN_DATE), 'YYYYMMDD'), 'YYYY-MM-DD') as "txnDate",
      to_char(T1.TXN_AMT/100,'9999999990.00') as "txnAmt", 
      T2.MERCHANT_NAME as "mchntName",
      decode(t1.TXN_STAT,'0','未退货','1','已退货') as "stat"
    from
      TB_TXN_REFUND T1,
      TB_ENT_MERCHANT T2
    where
      T1.MCHNT_ID = T2.MERCHANT_ID
      and T1.TXN_STAT = #txnStat:DECIMAL#
    <dynamic>
    	<isNotEmpty prepend="and" property="cardNo">
        	T1.CARD_NO = #cardNo:VARCHAR#
      	</isNotEmpty>
      <isNotEmpty prepend="and" property="mchntId">
        T1.MCHNT_ID = #mchntId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="sysSeqNum">
        T1.SYS_SEQ_NUM = #sysSeqNum:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="mchntName">
        T2.MERCHANT_NAME like '%'||#mchntName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="startDate">
      	T1.TXN_DATE &gt;=to_number(to_char(#startDate:DATE#,'yyyyMMdd'))
      </isNotEmpty>
      <isNotEmpty prepend="and" property="endDate">
      	T1.TXN_DATE &lt;=to_number(to_char(#endDate:DATE#,'yyyyMMdd'))
      </isNotEmpty>
      <isNull prepend="and" property="issuerId">
        <isNotEqual property="defaultIssuerId" compareValue="0">
          T2.ISSUER_ID = #defaultIssuerId:DECIMAL#
        </isNotEqual>
        <isEqual property="defaultIssuerId" compareValue="0">
          T2.ISSUER_GROUP_ID = #defaultIssuerGroupId:DECIMAL#
        </isEqual>
      </isNull>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
</sqlMap>