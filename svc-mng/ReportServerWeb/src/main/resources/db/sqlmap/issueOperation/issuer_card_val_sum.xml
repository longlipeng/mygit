<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="issuer_card_val_sum">
	<select id="issuer_card_val_sum" resultClass="com.allinfinance.service.issueOperation.issuerCardValSum.dto.IssuerCardValSumDTO"
		parameterClass="com.allinfinance.service.issueOperation.issuerCardValSum.dto.IssuerCardValSumDTO">
select decode(t2.acc_bal,null,'0.00',t2.acc_bal) "accBal", decode(t1.act_amt,null,'0.00',t1.act_amt) "actAmt", decode(t1.txn_amt,null,'0.00',t1.txn_amt) "txnAmt", decode(t3.acc_bal,null,'0.00',t3.acc_bal) as "endAccBal"
  from tb_issuer t4
        left join
       (select trim(issuer_id) as issuer_id, trim(to_char(sum(act_amt)/100,'9999999990.99')) act_amt, trim(to_char(sum(txn_amt)/100,'9999999990.99')) txn_amt
          from tb_acc_card_bal
         where issuer_id = #entityId:varchar#
           and to_date(date_settle, 'yyyyMMdd') &gt;=
               to_date(#startDate:char#, 'yyyy-MM-dd')
           and to_date(date_settle, 'yyyyMMdd') &lt;=
               to_date(#endDate:char#, 'yyyy-MM-dd')
         group by issuer_id) t1 on t4.entity_id = t1.issuer_id
       left join
       (select trim(issuer_id)  as issuer_id, trim(to_char(acc_bal/100,'9999999990.99')) acc_bal
          from tb_acc_card_bal
         where issuer_id = #entityId:varchar#
           and to_date(date_settle, 'yyyyMMdd') =
               to_date(#startDate:char#, 'yyyy-MM-dd') - 1) t2 on t4.entity_id = t2.issuer_id
      left join
       (select trim(issuer_id) as issuer_id, trim(to_char(acc_bal/100,'9999999990.99')) acc_bal
          from tb_acc_card_bal
         where issuer_id = #entityId:varchar#
           and to_date(date_settle, 'yyyyMMdd') =
               to_date(#endDate:char#, 'yyyy-MM-dd')) t3 on t4.entity_id = t3.issuer_id
 where t4.entity_id=#entityId:varchar#
	</select>
</sqlMap>