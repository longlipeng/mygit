<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="consumer_sell_sum">
	<select id="consumer_sell_sum" resultClass="com.allinfinance.service.issueOperation.consumerSellSummary.dto.ConsumerSellSummaryDTO"
		parameterClass="com.allinfinance.service.issueOperation.consumerSellSummary.dto.ConsumerSellSummaryDTO">

select t14.entity_id "entityId",
       t14.consumer_name "consumerName",
       sum(decode(t2.num, null, 0, t2.num)) as "allnum",
       trim(to_char(sum(((decode(t3.trans_at_sgl, null, 0, t3.trans_at_sgl) -
                    decode(t4.trans_at_sgl, null, 0, t4.trans_at_sgl)) / 100)),
                    '9999999990.99')) as "allamt",
       sum((decode(t3.trans_at_sgl, null, 0, t3.trans_at_sgl) -
                    decode(t4.trans_at_sgl, null, 0, t4.trans_at_sgl)) / 100) as "nallamt",
       sum(decode(t5.num1, null, 0, t5.num1)) as "num1",
       trim(to_char(sum(decode(t5.amt1, null, 0, t5.amt1) / 100),
                    '9999999990.99')) as "amt1",
       sum(decode(t5.amt1, null, 0, t5.amt1) / 100) as "namt1",
       sum(decode(t6.num2, null, 0, t6.num2)) as "num2",
       trim(to_char(sum(decode(t6.amt2, null, 0, t6.amt2) / 100),
                    '9999999990.99')) as "amt2",
       sum(decode(t6.amt2, null, 0, t6.amt2) / 100) as "namt2",
       sum(decode(t7.num3, null, 0, t7.num3)) as "num3",
       trim(to_char(sum(decode(t7.amt3, null, 0, t7.amt3) / 100),
                    '9999999990.99')) as "amt3",
       sum(decode(t7.amt3, null, 0, t7.amt3) / 100) as "namt3",
       sum(decode(t8.num4, null, 0, t8.num4)) as "num4",
       trim(to_char(sum(decode(t8.amt4, null, 0, t8.amt4) / 100),
                    '9999999990.99')) as "amt4",
       sum(decode(t8.amt4, null, 0, t8.amt4) / 100) as "namt4",
       sum(decode(t9.num5, null, 0, t9.num5)) as "num5",
       trim(to_char(sum(decode(t9.amt5, null, 0, t9.amt5) / 100),
                    '9999999990.99')) as "amt5",
       sum(decode(t9.amt5, null, 0, t9.amt5) / 100) as "namt5",
       sum(decode(t10.num6, null, 0, t10.num6)) as "num6",
       trim(to_char(sum(decode(t10.amt6, null, 0, t10.amt6) / 100),
                    '9999999990.99')) as "amt6",
       sum(decode(t10.amt6, null, 0, t10.amt6) / 100) as "namt6",
       sum(decode(t11.num7, null, 0, t11.num7)) as "num7",
       trim(to_char(sum(decode(t11.amt7, null, 0, t11.amt7) / 100),
                    '9999999990.99')) as "amt7",
       sum(decode(t11.amt7, null, 0, t11.amt7) / 100) as "namt7",
        0 "zero",
       '0.00' "allzero",
       sum(decode(t12.num8, null, 0, t12.num8)) as "num8",
       trim(to_char(sum(decode(t12.amt8, null, 0, t12.amt8) / 100),
                    '9999999990.99')) as "amt8",
       sum(decode(t12.amt8, null, 0, t12.amt8) / 100) as "namt8",
       sum(decode(t13.num9, null, 0, t13.num9)) as "num9",
       trim(to_char(sum(decode(t13.amt9, null, 0, t13.amt9) / 100),
                    '9999999990.99')) as "amt9",
       sum(decode(t13.amt9, null, 0, t13.amt9) / 100) as "namt9"
  from tb_merchant t1
       left join
       (select t.mchnt_cd, count(t.txn_seq_no) as num
          from tb_settle_trans_pre t
         where t.trans_id in
               ('S22', 'S20', 'S32', 'S66', 'S55', 'S30', 'V52', 'V50', 'V62','G22','G32','G30')
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         and   trim(t.pri_acct_no) !='00'
         group by t.mchnt_cd) t2 on t1.merchant_code = t2.mchnt_cd
       left join
       (select t.mchnt_cd, sum(t.trans_at_sgl) as trans_at_sgl
          from tb_settle_trans_pre t
         where t.trans_id in ('S22', 'S20', 'S66', 'V62','G22')
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         and   trim(t.pri_acct_no) !='00'
         group by t.mchnt_cd) t3 on t1.merchant_code = t3.mchnt_cd
       left join
       (select t.mchnt_cd, sum(t.trans_at_sgl) as trans_at_sgl
          from tb_settle_trans_pre t
         where t.trans_id in ('S32', 'S30', 'S55', 'V52', 'V50','G32','G30')
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t4 on t1.merchant_code = t4.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num1,
               sum(t.trans_at_sgl) as amt1
          from tb_settle_trans_pre t
         where t.trans_id in ('S22','G22')
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         and   trim(t.pri_acct_no) !='00'
         group by t.mchnt_cd) t5 on t1.merchant_code = t5.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num2,
               sum(t.trans_at_sgl) as amt2
          from tb_settle_trans_pre t
         where t.trans_id = 'V52'
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t6 on t1.merchant_code = t6.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num3,
               sum(t.trans_at_sgl) as amt3
          from tb_settle_trans_pre t
         where t.trans_id = 'S20'
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t7 on t1.merchant_code = t7.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num4,
               sum(t.trans_at_sgl) as amt4
          from tb_settle_trans_pre t
         where t.trans_id = 'V50'
        and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t8 on t1.merchant_code = t8.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num5,
               sum(t.trans_at_sgl) as amt5
          from tb_settle_trans_pre t
         where t.trans_id in ('S32','G32')
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t9 on t1.merchant_code = t9.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num6,
               sum(t.trans_at_sgl) as amt6
          from tb_settle_trans_pre t
         where t.trans_id = 'V62'
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t10 on t1.merchant_code = t10.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num7,
               sum(t.trans_at_sgl) as amt7
          from tb_settle_trans_pre t
         where t.trans_id in ('S30','G30')
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t11 on t1.merchant_code = t11.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num8,
               sum(t.trans_at_sgl) as amt8
          from tb_settle_trans_pre t
         where t.trans_id ='S55'
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t12 on t1.merchant_code = t12.mchnt_cd
       left join
       (select t.mchnt_cd,
               count(t.txn_seq_no) as num9,
               sum(t.trans_at_sgl) as amt9
          from tb_settle_trans_pre t
         where t.trans_id ='S66'
         and   to_date(t.settle_dt,'yyyyMMdd')&gt;=to_date(#startDate#,'yyyy-MM-dd')
         and   to_date(t.settle_dt,'yyyyMMdd')&lt;= to_date(#endDate#,'yyyy-MM-dd')
         group by t.mchnt_cd) t13 on t1.merchant_code = t13.mchnt_cd,
         tb_consumer t14
 where t1.father_entity_id=t14.entity_id
   and t1.FATHER_ENTITY_ID in (select con.entity_id from tb_consumer con where con.father_entity_id=#issuerId#)
   group by t14.entity_id,
            t14.consumer_name

	</select>
</sqlMap>