<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:rabbit="http://www.springframework.org/schema/rabbit"
	xsi:schemaLocation="http://www.springframework.org/schema/rabbit http://www.springframework.org/schema/rabbit/spring-rabbit-1.3.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
	
	<rabbit:connection-factory id="connectionFactory" username="#{env.mqUser}" password="#{env.mqPassword}" 
	    addresses="#{env.mqServer1}:#{env.mqPort1},#{env.mqServer2}:#{env.mqPort2}" />
	
	<rabbit:admin connection-factory="connectionFactory" auto-startup="true"/>
	<rabbit:queue id="icspReplyTest"  name="icspReplyTest">
		<rabbit:queue-arguments>
       		<entry key="x-ha-policy" value="all"/>
		</rabbit:queue-arguments>
	</rabbit:queue>
	<rabbit:queue id="icspReqTest" name="icspReqTest">
		<rabbit:queue-arguments>
       		<entry key="x-ha-policy" value="all"/>
		</rabbit:queue-arguments>
	</rabbit:queue>
	
	
	
	<rabbit:template id="amqpTemplate" routing-key="icspReqTest" queue="icspReqTest" connection-factory="connectionFactory" 
		reply-timeout="10000" message-converter="icspMessageConverter">
	</rabbit:template>
	
	<rabbit:listener-container concurrency="5" max-concurrency="10" connection-factory="connectionFactory" auto-startup="false" prefetch="200">
		<rabbit:listener ref="icspReqListener" queues="icspReqTest"/>
	</rabbit:listener-container>	
	
	<bean id="icspReqListener" class="com.allinfinance.tlkms.mq.IcspMessageListener">
		<property name="template" ref="amqpTemplate"/>
	</bean>

	<bean id="icspMessageConverter" class="com.allinfinance.tlkms.mq.IcspMessageConverter"/>
</beans>
