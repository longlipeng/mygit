<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="POINT_RULE">
  <select id="selectPointRuleOne" parameterClass="com.huateng.accor.pointrule.dto.PointRuleQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
      distinct (T1.POINT_RULE_ID) as "pointRuleId",
      T1.RULE_TYPE as "ruleType",
      T1.PRODUCT_ID as "productId",
      T1.RULE_START_DATE as "ruleStartDate",
      T1.RULE_END_DATE as "ruleEndDate",
      T1.CONSUME_AMOUNT as "consumeAmount",
      T1.CONSUME_POINT || '‰' as "consumePoint",
      T2.PRODUCT_NAME as "productName"
    from
      TB_ENT_POINT_RULE T1,
      TB_ENT_PRODUCT T2,
      TB_ENT_POINT_RULE_DETAIL T3,
      TB_ENT_MERCHANT T4
    where
      T1.PRODUCT_ID = T2.PRODUCT_ID
      AND T1.POINT_RULE_ID = T3.POINT_RULE_ID
      AND T4.MERCHANT_ID = T3.MERCHANT_ID
      AND T1.RULE_TYPE = 1
      AND T1.DATA_STATE = '1'
      AND T2.DATA_STATE = '1'
      AND T3.DATA_STATE = '1'
      AND T4.DATA_STATE = '1'
    <dynamic>
      <isNotEmpty prepend="and" property="productId">
        T1.PRODUCT_ID = #productId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="productName">
        T2.PRODUCT_NAME like '%'||#productName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ruleStartDate">
        (to_char(T1.RULE_START_DATE,'yyyymmdd') &gt;= #ruleStartDate:VARCHAR#)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ruleEndDate">
        (((T1.RULE_END_DATE is not null and to_char(T1.RULE_END_DATE,'yyyymmdd') &lt;= #ruleEndDate:VARCHAR#)
        or (T1.RULE_END_DATE is null)) and to_char(T1.RULE_START_DATE,'yyyymmdd') &lt;= #ruleEndDate:VARCHAR#) 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantId">
        T3.MERCHANT_ID = #merchantId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantName">
        T4.MERCHANT_NAME like '%'||#merchantName:VARCHAR#||'%'
      </isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>

  <select id="selectPointRuleTwo" parameterClass="com.huateng.accor.pointrule.dto.PointRuleQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
      distinct (T1.POINT_RULE_ID) as "pointRuleId",
      T1.RULE_TYPE as "ruleType",
      T1.PRODUCT_ID as "productId",
      T1.RULE_START_DATE as "ruleStartDate",
      T1.RULE_END_DATE as "ruleEndDate",
      T2.PRODUCT_NAME as "productName"
    from
      TB_ENT_POINT_RULE T1,
      TB_ENT_PRODUCT T2,
      TB_ENT_POINT_RULE_DETAIL T3,
      TB_ENT_MERCHANT T4
    where
      T1.PRODUCT_ID = T2.PRODUCT_ID
      AND T1.POINT_RULE_ID = T3.POINT_RULE_ID
      AND T4.MERCHANT_ID = T3.MERCHANT_ID
      AND T1.RULE_TYPE = 2
      AND T1.DATA_STATE = '1'
      AND T2.DATA_STATE = '1'
      AND T3.DATA_STATE = '1'
      AND T4.DATA_STATE = '1'
    <dynamic>
      <isNotEmpty prepend="and" property="productId">
        T1.PRODUCT_ID = #productId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="productName">
        T2.PRODUCT_NAME like '%'||#productName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ruleStartDate">
        (to_char(T1.RULE_START_DATE,'yyyymmdd') &gt;= #ruleStartDate:VARCHAR#)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ruleEndDate">
        (((T1.RULE_END_DATE is not null and to_char(T1.RULE_END_DATE,'yyyymmdd') &lt;= #ruleEndDate:VARCHAR#)
        or (T1.RULE_END_DATE is null)) and to_char(T1.RULE_START_DATE,'yyyymmdd') &lt;= #ruleEndDate:VARCHAR#) 
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantId">
        T3.MERCHANT_ID = #merchantId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantName">
        T4.MERCHANT_NAME like '%'||#merchantName:VARCHAR#||'%'
      </isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>

  <select id="selectPointRuleThree" parameterClass="com.huateng.accor.pointrule.dto.PointRuleQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
      T1.POINT_RULE_ID as "pointRuleId",
      T1.RULE_TYPE as "ruleType",
      T1.PRODUCT_ID as "productId",
      T1.RULE_START_DATE as "ruleStartDate",
      T1.RULE_END_DATE as "ruleEndDate",
      T1.CONSUME_AMOUNT as "consumeAmount",
      T1.CONSUME_POINT || '‰' as "consumePoint",
      T2.PRODUCT_NAME as "productName"
    from
      TB_ENT_POINT_RULE T1,
      TB_ENT_PRODUCT T2
    where
      T1.PRODUCT_ID = T2.PRODUCT_ID
      AND T1.RULE_TYPE = 3
      AND T1.DATA_STATE = '1'
      AND T2.DATA_STATE = '1'
    <dynamic>
      <isNotEmpty prepend="and" property="productId">
        T1.PRODUCT_ID = #productId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="productName">
        T2.PRODUCT_NAME like '%'||#productName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ruleStartDate">
        (to_char(T1.RULE_START_DATE,'yyyymmdd') &gt;= #ruleStartDate:VARCHAR#)
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ruleEndDate">
        (((T1.RULE_END_DATE is not null and to_char(T1.RULE_END_DATE,'yyyymmdd') &lt;= #ruleEndDate:VARCHAR#)
        or (T1.RULE_END_DATE is null)) and to_char(T1.RULE_START_DATE,'yyyymmdd') &lt;= #ruleEndDate:VARCHAR#) 
      </isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>

  <select id="selectMchnts" parameterClass="com.huateng.accor.pointrule.dto.PointRuleDTO" resultClass="java.util.HashMap" remapResults="true">
    select
      T2.MERCHANT_ID as "merchantId",
      T3.MERCHANT_NAME as "merchantName"
    from
      TB_ENT_POINT_RULE T1,
      TB_ENT_POINT_RULE_DETAIL T2,
      TB_ENT_MERCHANT T3
    where
      T2.MERCHANT_ID = T3.MERCHANT_ID
      AND T1.POINT_RULE_ID = T2.POINT_RULE_ID
      AND T1.DATA_STATE = '1'
      AND T2.DATA_STATE = '1'
      AND T3.DATA_STATE = '1'
    <dynamic>
      <isNotEmpty prepend="and" property="pointRuleId">
        T1.POINT_RULE_ID = #pointRuleId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantId">
        T1.MERCHANT_ID = #merchantId:VARCHAR#
      </isNotEmpty>
    </dynamic>
  </select>
</sqlMap>