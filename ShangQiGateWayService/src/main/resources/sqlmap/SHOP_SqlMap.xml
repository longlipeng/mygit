<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="SHOP">
  <select id="selectShopByDTO" parameterClass="com.allinfinance.univer.consumer.shop.dto.ShopQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
        T1.SHOP_ID as "shopId",
        T1.SHOP_NAME as "shopName",
        T1.SHOP_CITY as "shopCity",
        T1.BUSINESS_AREA as "businessArea",
        T2.merchant_name as "merchantName",
        decode(T1.SHOP_STATE,'1','有效','2','门店切换','无效') as "shopState",
        T2.merchant_code as "merchantCode",
        T1.shop_address as "shopAddress",
        T1.shop_code as "shopCode",
        T1.entity_id as "entityId"
    from
        TB_SHOP T1,
		TB_MERCHANT T2
    where
        T1.ENTITY_ID=T2.ENTITY_ID
        AND T2.DATA_STATE = '1'
        AND T1.DATA_STATE = '1'     
    <dynamic>
     <isNotEmpty prepend="and" property="consumerId">
        T1.consumer_id=#consumerId:VARCHAR#
      </isNotEmpty>
       <isNotEmpty prepend="and" property="shopId">
        T1.SHOP_Id = #shopId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantCode">
        T2.merchant_code like '%'||#merchantCode:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="entityName">
        T2.MERCHANT_NAME like '%'||#entityName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="shopCode">
        T1.SHOP_CODE like '%'||#shopCode:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="shopName">
        T1.SHOP_NAME like '%'||#shopName:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="shopCity">
        T1.SHOP_CITY = #shopCity:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="businessArea">
        T1.BUSINESS_AREA = #businessArea:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="shopState">
        T1.SHOP_STATE = #shopState:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="entityId">
        T1.entity_id = #entityId:VARCHAR#
      </isNotEmpty>
    </dynamic>
     AND T2.FATHER_ENTITY_ID=T1.consumer_id
    <include refid="Commons.suffixSql"/>
  </select>
  
   <select id="selectShopList" parameterClass="java.lang.String" resultClass="java.util.HashMap" remapResults="true">
  	select T1.SHOP_ID as "shopId",
  		   T1.SHOP_NAME as "shopName"
  	from TB_ENT_SHOP  T1
  	WHERE
  	T1.DATA_STATE='1'  AND
  	T1.MERCHANT_ID= #merchantId:VARCHAR#
  </select>
  
</sqlMap>