<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="BLACKLIST">
<select id="selectBlackListByDTO" parameterClass="com.allinfinance.univer.consumer.blacklist.dto.BlackListQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
        T1.CARD_NO as "cardNo",
        T1.MENO as "meno",
        T1.CREATE_USER as "createUser",
        T1.CREATE_TIME as "createTime",
        T1.MODIFY_USER as "modifyUser",
        T1.MODIFY_TIME as "modifyTime",
        decode(T1.DATA_STATE,'1','有效','0','无效') as "dataState"
    from
        TB_BLACKLIST T1
    where T1.DATA_STATE='1' 
    <dynamic>
     <isNotEmpty prepend="and" property="cardNo">
        T1.CARD_NO=#cardNo:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="meno">
        T1.MENO like '%'||#meno:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="createUser">
        T1.CREATE_USER like '%'||#createUser:VARCHAR#||'%'
      </isNotEmpty>
     
      <isNotEmpty property="startDate" prepend="and">
      		to_date(subStr(T1.CREATE_TIME,1,8), 'yyyy-MM-dd')&gt;=to_date(to_char(#startDate:DATE#,'YYYY-MM-DD'),'yyyy-MM-dd')
      	</isNotEmpty>
      	<isNotEmpty property="endDate" prepend="and">
      		to_date(subStr(T1.CREATE_TIME,1,8), 'yyyy-MM-dd')&lt;=to_date(to_char(#endDate:DATE#,'YYYY-MM-DD'),'yyyy-MM-dd')
      	</isNotEmpty>
      <isNotEmpty prepend="and" property="modifyUser">
        T1.MODIFY_USER like '%'||#modifyUser:VARCHAR#||'%'
      </isNotEmpty>
      <isNotEmpty prepend="and" property="modifyTime">
        T1.MODIFY_TIME = #shopCity:CHAR#
      </isNotEmpty>
     
      <isNotEmpty prepend="and" property="dataState">
        T1.DATA_STATE = #dataState:CHAR#
      </isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  
  <update id="updateBlackListDateStateByNo" parameterClass="com.huateng.framework.ibatis.model.BlackList" >
    update TB_BLACKLIST
    set DATA_STATE = '0'
    where CARD_NO = #cardNo:VARCHAR#
  </update>
</sqlMap>