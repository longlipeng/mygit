<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TxnRecord">
  <select id="selectTxnRecordByDTO" parameterClass="com.allinfinance.shangqi.gateway.dto.TxnqueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    SELECT
    seq_no as "orderNo",
    rtrim(ltrim(to_char( txn_amt/100,'999999999990.99'))) as "banlance",
    decode(txn_type,7125,decode(ORDER_ID,'1003','银联充值',null,'网银充值','','网银充值'),1115,'转充值',1105,'消费')   as "payType",
    card_no    as "cardNo",
    to_date(date_txn||time_txn,'yyyy-mm-dd hh24:mi:ss') as "txnDate",
    txn_stat   as "txnStat" ,
    trans_seq_no2 as "transSeqNo",
    cancel_flag as "cancelFlag",
    revsal_flag as "revsalFlag"
	FROM
    	tb_acc_txn   
 	where 
 		txn_type in('7125','1115','1105')
 		and 
 		ORDER_ID != '9999'
 		and
 		card_no = #cardNo:VARCHAR#
    <dynamic>
    	<isNotEmpty prepend="and" property="starDate">
    		<![CDATA[
            date_txn >= #starDate:CHAR#
            ]]>
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="enDate">
    		<![CDATA[
            date_txn <= #enDate:VARCHAR#
            ]]>
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="txnStat">
    		txn_stat = #txnStat:CHAR#
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="payType">
    		txn_type = #payType:CHAR#
    	</isNotEmpty>
    </dynamic>
    union
    	 SELECT
    seq_no as "orderNo",
     rtrim(ltrim(to_char( txn_amt/100,'999999999990.99'))) as "banlance",
    decode(txn_type,7125,decode(ORDER_ID,'1003','银联充值',null,'网银充值','','网银充值'),1115,'转充值',1105,'消费')   as "payType",
    card_no    as "cardNo",
    to_date(date_txn||time_txn,'yyyy-mm-dd hh24:mi:ss') as "txnDate",
    txn_stat   as "txnStat" ,
     trans_seq_no2 as "transSeqNo",
     cancel_flag as "cancelFlag",
    revsal_flag as "revsalFlag"
	FROM
    	tb_acc_txn_his  
 	where 
 		txn_type in('7125','1115','1105')
 		and 
 		ORDER_ID != '9999'
 		and 
 		card_no = #cardNo:VARCHAR#
    <dynamic>
    	<isNotEmpty prepend="and" property="starDate">
    		<![CDATA[
            date_txn >= #starDate:CHAR#
            ]]>
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="enDate">
    		<![CDATA[
            date_txn <= #enDate:VARCHAR#
            ]]>
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="txnStat">
    		txn_stat = #txnStat:CHAR#
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="payType">
    		txn_type = #payType:CHAR#
    	</isNotEmpty>
    </dynamic>
   <!--  union
     SELECT
    seq_no as "orderNo",
    rtrim(ltrim(to_char( txn_amt/100,'999999999990.99'))) as "banlance",
   decode(txn_type,7125,'网银充值',1115,'转充值',1105,'消费')   as "payType",
    card_no    as "cardNo",
    to_date(date_txn||time_txn,'yyyy-mm-dd hh24:mi:ss') as "txnDate",
    txn_stat   as "txnStat" ,
     trans_seq_no2 as "transSeqNo",
      cancel_flag as "cancelFlag",
    revsal_flag as "revsalFlag"
	FROM
    	tb_acc_txn_tmp   
 	where 
 		txn_type in('7125','1115','1105')
 		and 
 		card_no = #cardNo:VARCHAR#
    <dynamic>
    	<isNotEmpty prepend="and" property="starDate">
    		<![CDATA[
            date_txn >= #starDate:CHAR#
            ]]>
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="enDate">
    		<![CDATA[
            date_txn <= #enDate:VARCHAR#
            ]]>
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="txnStat">
    		txn_stat = #txnStat:CHAR#
    	</isNotEmpty>
    	<isNotEmpty prepend="and" property="payType">
    		txn_type = #payType:CHAR#
    	</isNotEmpty>
    </dynamic> -->
    <!-- <dynamic>
       <isNotEmpty prepend="and" property="fatherEntityId">
        T1.father_entity_id = #fatherEntityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="entityId">
        T1.ENTITY_ID = #entityId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantCode">
        T1.MERCHANT_CODE = #merchantCode:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantName">
        UPPER(T1.MERCHANT_NAME) like UPPER('%'||#merchantName:VARCHAR#||'%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="externalId">
        T1.EXTERNAL_ID= #externalId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantState">
        T1.MERCHANT_STATE = #merchantState:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantRealityName">
        UPPER(T1.MERCHANT_REALITY_NAME) like UPPER('%'||#merchantRealityName:VARCHAR#||'%')
      </isNotEmpty>
      <isNotEmpty prepend="and" property="merchantAttribute">
        T1.MERCHANT_ATTRIBUTE = #merchantAttribute:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="ePayIn">
        T1.E_PAY_IN = #ePayIn:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="dataState">
        T1.DATA_STATE = #dataState:VARCHAR#
      </isNotEmpty> 
    </dynamic> -->
    
    <include refid="Commons.suffixSql"/>
  </select> 
  
  
</sqlMap>