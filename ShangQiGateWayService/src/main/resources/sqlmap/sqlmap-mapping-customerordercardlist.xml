<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TB_ENT_ORDER_CARD_LIST">
	<select id="selectOrderCardList" resultClass="java.util.HashMap" parameterClass="com.huateng.accorecard.customerorder.dto.CustomerOrderCardListQueryDTO" remapResults="true">
    <include refid="Commons.prefixSql"/>
    	select
    		ORDER_CARD_ID as "orderCardId",
    		PRODUCT_ID    as   "productId",
    		CARD_LAYOUT_ID as  "cardLayoutId",
    		FACE_VALUE_TYPE as   "faceValueType",
    		FACE_VALUE/100      as   "faceValue",
    		CARD_STATE      as    "cardState",
    		ORDER_ID as "orderId",
    		CARD_NO as "cardNo",
    		IS_PACKAGE_FLAG as "isPackageFlag",
    		CREATE_USER  as "createUser",
    		CREATE_TIME as "createTime"
    	from 
    		TB_ENT_ORDER_CARD_LIST
    	where
    		ORDER_ID = #orderId:DECIMAL#
    	and
    		DATA_STATE = 1
    <dynamic>
    	<isNotEmpty prepend="and" property="cardNo">
			CARD_NO = #cardNo:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="cardState">
			CARD_STATE = #cardState:DECIMAL#
		</isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  
  <select id="checkOrderCard" resultClass="java.util.HashMap" parameterClass="com.huateng.accor.ordercardlist.dto.OrderCardListDTO">
  	
  	select * from  TB_ENT_ISSUER_STOCK
  	where CARD_NO=#cardNo#
  	and   PRODUCT_ID=#productId#
  	and   CARD_VALID_DATE>=#cardValidDate#
  	<isEqual property="faceValueType" compareValue="0">
  	and FACE_VALUE=#faceValue#
  	</isEqual>
  </select>
  
  
  
</sqlMap>
