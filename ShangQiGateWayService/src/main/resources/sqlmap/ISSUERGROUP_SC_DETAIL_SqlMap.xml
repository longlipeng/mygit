<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ISSUERGROUPSCDETAIL">
  <select id="selectIssuerGrouPScDetailByDTO" parameterClass="com.huateng.accorecard.issuerGroupScDetail.dto.IssuerGroupScDetailQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
    	T1.DETAIL_ID    as    "detailId",
    	T1.ISSUER_GROUP_STOCK_COUNT_ID as "stockCountId",
    	T1.ORDER_BARCODE    as "orderBarcode",
       	decode(T1.STOCK_COUNT_FLAG,0,'未盘点到',1,'盘点正常','新增')        as "state",
       	 T2.USER_NAME      as   "operationUser",
       	 T1.NOTES          as    "notes",
        T1.CREATE_TIME      as   "createTime"
    from
     	TB_ENT_ISSUERGROUP_SC_DETAIL T1,
     	TB_ENT_USER               T2
     where
     	T1.DATA_STATE='1'
     	and T1.OPERATION_ID=T2.USER_ID(+)
    <dynamic>
     		<isNotNull prepend="and" property="detailId">
       			 T1.DETAIL_ID = #detailId:DECIMAL#
      		</isNotNull>
      		<isNotNull prepend="and" property="stockCountId">
       			 T1.ISSUER_GROUP_STOCK_COUNT_ID = #stockCountId:DECIMAL#
      		</isNotNull>
      		<isNotEmpty prepend="and" property="orderBarcode">
       			 T1.ORDER_BARCODE like '%'||#orderBarcode:VARCHAR#||'%'
      		</isNotEmpty>
      		<isNotNull prepend="and" property="stockCountFlag">
       			 T1.STOCK_COUNT_FLAG = #stockCountFlag:DECIMAL#
      		</isNotNull>
      		<isNotEmpty prepend="and" property="createTime">
       			 T1.CREATE_TIME like '%'||#createTime:DATE#||'%'
      		</isNotEmpty>
      		<isNotEmpty prepend="and" property="operationUser">
       			 UPPER(T2.USER_NAME) like UPPER('%'||#operationUser:VARCHAR#||'%')
      		</isNotEmpty>
    	</dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
</sqlMap>