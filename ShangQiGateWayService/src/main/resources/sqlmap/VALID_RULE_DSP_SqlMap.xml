<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="VALIDRULEDSP">
	<select id="selectValidRuleList" resultClass="java.util.HashMap"
		parameterClass="com.allinfinance.univer.issuer.dto.product.ValidPeriodRuleQueryDTO"
		remapResults="true">
		<include refid="Commons.prefixSql" />
	  select 
	  T1.rule_dsp_id as "ruleId",
	  T1.rule_name as "ruleName",
	  t1.trans_type as "transType",
	  decode(T1.trans_type,'1','充值','2','激活','3','延期') as "transTypeName",
	  T1.branch_mark as "branchMark",
	  decode(T1.branch_mark,'1','卡片原有效期','2','交易日期') as "branchMarkName",
	  to_char(to_date(T1.dead_line,'yyyy-MM-dd'),'YYYY-MM-DD') as "deadLine",
	  decode(T1.rule_state,'1','新建','2','启用','0','删除') as "ruleState",
	  to_char(to_date(T1.modify_time,'yyyy-MM-dd hh24:mi:ss'),'YYYY-MM-DD HH24:MI:SS') as "modifyTime"
	  from tb_valid_rule_dsp T1
	  where 1=1
		<dynamic>
		   <isNotEmpty prepend="and" property="entityId">
				T1.ENTITY_ID = #entityId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ruleId">
				T1.RULE_DSP_ID=#ruleId:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="ruleName">
				T1.RULE_NAME LIKE '%'||#ruleName:VARCHAR#||'%'
			</isNotEmpty>
			<isNotEmpty prepend="and" property="transType">
				T1.TRANS_TYPE =#transType:VARCHAR#
			</isNotEmpty>
		    <isNotEmpty prepend="and" property="ruleState">
				T1.RULE_STATE =#ruleState:VARCHAR#
			</isNotEmpty>
		</dynamic>
		<include refid="Commons.suffixSql" />
	</select>
	<select id="selectValidRuleDsp" resultClass="com.allinfinance.univer.issuer.dto.product.ValidPeriodRuleDspDTO"
		parameterClass="com.allinfinance.univer.issuer.dto.product.ValidPeriodRuleDspDTO"
		remapResults="true">
	select
	T1.rule_dsp_id as "ruleDspId",
	T1.rule_name as "ruleName",
	t1.trans_type as "transType",
	decode(T1.trans_type,'1','充值','2','激活','3','延期') as "transTypeName",
	T1.branch_mark as "branchMark",
    decode(T1.branch_mark,'1','卡片原有效期','2','交易日期') as "branchMarkName",
	to_char(to_date(T1.dead_line,'yyyy-MM-dd'),'YYYY-MM-DD') as "deadLine",
	decode(T1.rule_state,'1','新建','2','启用','0','删除') as "ruleState",
	to_char(to_date(T1.create_time,'yyyy-MM-dd hh24:mi:ss'),'YYYY-MM-DD	HH24:MI:SS') as "createTime",
	t2.user_name as "createUserName"
	from tb_valid_rule_dsp t1,tb_ent_user t2
	where t1.create_user =t2.user_id
	and
				T1.RULE_DSP_ID=#ruleDspId:VARCHAR#
	and t1.trans_type=#transType#
		</select>
	<select id="selectList" resultClass="com.allinfinance.univer.issuer.dto.product.ValidPeriodRuleDspDTO"
		parameterClass="com.allinfinance.univer.issuer.dto.product.ProductQueryDTO"
		remapResults="true">
	select distinct
	T1.rule_dsp_id as "ruleDspId",
	T1.rule_name as "ruleName",
	t1.trans_type as "transType",
	decode(T1.trans_type,'1','充值','2','激活','3','延期') as "transTypeName",
	T1.branch_mark as "branchMark",
    decode(T1.branch_mark,'1','卡片原有效期','2','交易日期') as "branchMarkName",
	to_char(to_date(T1.dead_line,'yyyy-MM-dd'),'YYYY-MM-DD') as "deadLine",
	decode(T1.rule_state,'1','新建','2','启用','0','删除') as "ruleState",
	to_char(to_date(T1.create_time,'yyyy-MM-dd hh24:mi:ss'),'YYYY-MM-DD	HH24:MI:SS') as "createTime"
	from tb_valid_rule_dsp t1
	where t1.rule_state='2'
	<dynamic>
		   <isNotEmpty prepend="and" property="entityId">
				T1.ENTITY_ID = #entityId:VARCHAR#
			</isNotEmpty>
			</dynamic>
		</select>
</sqlMap>
