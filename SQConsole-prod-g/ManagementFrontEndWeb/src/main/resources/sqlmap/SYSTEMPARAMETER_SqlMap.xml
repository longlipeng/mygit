<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="SYSTEMPARAMETER">
 <resultMap id="EntitySystemParameterResult" class="com.allinfinance.univer.system.sysparam.dto.EntitySystemParameterDTO" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sun Sep 26 15:55:52 CST 2010.
    -->
    <result column="ENTITY_ID" property="entityId" jdbcType="VARCHAR" />
    <result column="FATHER_ENTITY_ID" property="fatherEntityId" jdbcType="VARCHAR" />
    <result column="PARAMETER_CODE" property="parameterCode" jdbcType="VARCHAR" />
    <result column="PARAMETER_NAME" property="parameterName" jdbcType="VARCHAR" />
    <result column="PARAMETER_VALUE" property="parameterValue" jdbcType="VARCHAR" />
    <result column="PARAMETER_ROLE" property="parameterRole" jdbcType="VARCHAR" />
    <result column="PARAMETER_COMMENT" property="parameterComment" jdbcType="VARCHAR" />
    <result column="CREATE_USER" property="createUser" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="CHAR" />
    <result column="MODIFY_USER" property="modifyUser" jdbcType="VARCHAR" />
    <result column="MODIFY_TIME" property="modifyTime" jdbcType="CHAR" />
    <result column="DATA_STATE" property="dataState" jdbcType="CHAR" />
  </resultMap>
    <select id="selectEntitySystemParameter" parameterClass="com.allinfinance.univer.system.sysparam.dto.EntitySystemParameterQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    SELECT 
      T1.ENTITY_ID as "entityId", 
      T1.FATHER_ENTITY_ID as "fatherEntityId", 
      T1.PARAMETER_CODE as "parameterCode", 
      T1.PARAMETER_NAME as "parameterName", 
      T1.PARAMETER_VALUE as "parameterValue",
      T1.PARAMETER_ROLE as "parameterRole", 
      T1.PARAMETER_COMMENT as "parameterComment", 
      T1.CREATE_USER as "createUser", 
      T1.CREATE_TIME as "createTime", 
      T1.MODIFY_USER as "modifyUser", 
      T1.MODIFY_TIME as "modifyTime",
      T1.DATA_STATE as "dataState"
    FROM
     	TB_ENTITY_SYSTEM_PARAMETER T1
    WHERE
    	 T1.DATA_STATE = '1'
   	AND
   		 T1.ENTITY_ID = #entityId:VARCHAR#
    <dynamic>
    	<isNotEmpty prepend="and" property="parameterCode">
        			PARAMETER_CODE like '%'||#parameterCode:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterName">
        			PARAMETER_NAME like '%'||#parameterName:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterValue">
        			PARAMETER_VALUE = #parameterValue:VARCHAR#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterComment">
        			PARAMETER_COMMENT like '%'||#parameterComment:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterRole">
        			PARAMETER_ROLE like '%'||#parameterRole:VARCHAR#||'%'
      	</isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  <select id="selectSystemParameterByDTO" parameterClass="com.allinfinance.univer.system.sysparam.dto.SystemParameterQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
    	T1.PARAMETER_CODE as "parameterCode",
        T1.PARAMETER_NAME as "parameterName",
        T1.PARAMETER_VALUE as "parameterValue",
        T1.PARAMETER_COMMENT as "parameterComment",
        T1.PARAMETER_ROLE as "parameterRole"
    from
     	TB_SYSTEM_PARAMETER T1
    where
    	 T1.Data_State = '1'
    <dynamic>
    	<isNotEmpty prepend="and" property="parameterCode">
        			PARAMETER_CODE like '%'||#parameterCode:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterName">
        			PARAMETER_NAME like '%'||#parameterName:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterValue">
        			PARAMETER_VALUE = #parameterValue:VARCHAR#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterComment">
        			PARAMETER_COMMENT like '%'||#parameterComment:VARCHAR#||'%'
      	</isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  
  <select id="selectEntitySystemParameterByDTO" parameterClass="com.allinfinance.univer.system.sysparam.dto.EntitySystemParameterDTO" resultMap="EntitySystemParameterResult" remapResults="true">
    select ENTITY_ID, FATHER_ENTITY_ID, PARAMETER_CODE, PARAMETER_NAME, PARAMETER_VALUE,
      PARAMETER_ROLE, PARAMETER_COMMENT, CREATE_USER, CREATE_TIME, MODIFY_USER, MODIFY_TIME,
      DATA_STATE
    from
     	TB_ENTITY_SYSTEM_PARAMETER T1
    where
    	 T1.DATA_STATE = '1'
   	AND
   		 T1.ENTITY_ID = #entityId:VARCHAR#
    <dynamic>
    	<isNotEmpty prepend="and" property="parameterCode">
        			PARAMETER_CODE like '%'||#parameterCode:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterName">
        			PARAMETER_NAME like '%'||#parameterName:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterValue">
        			PARAMETER_VALUE = #parameterValue:VARCHAR#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterComment">
        			PARAMETER_COMMENT like '%'||#parameterComment:VARCHAR#||'%'
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="parameterRole">
        			PARAMETER_ROLE like '%'||#parameterRole:VARCHAR#||'%'
      	</isNotEmpty>
    </dynamic>
  </select>
  
  
  <insert id="insertEntitySysParamFromSysParam" parameterClass="com.huateng.framework.ibatis.model.EntitySystemParameter">
       insert into TB_ENTITY_SYSTEM_PARAMETER
		  ( PARAMETER_CODE,
			PARAMETER_NAME,
			PARAMETER_VALUE,
			PARAMETER_ROLE,
			PARAMETER_COMMENT,
			DATA_STATE,
			CREATE_USER,
			CREATE_TIME,
			MODIFY_USER,
			MODIFY_TIME,
			ENTITY_ID,
			FATHER_ENTITY_ID
		   )
	   SELECT
	       	PARAMETER_CODE,
			PARAMETER_NAME,
			PARAMETER_VALUE,
			PARAMETER_ROLE,
			PARAMETER_COMMENT,
			#dataState:VARCHAR#,
			#createUser:VARCHAR#,
            #createTime:VARCHAR#,
            #modifyUser:VARCHAR#,
            #modifyTime:VARCHAR#,
	        #entityId:VARCHAR#,
	        '00000000'
	   FROM
	       TB_SYSTEM_PARAMETER T
	   WHERE
	       T.DATA_STATE = '1'
  </insert>
  <insert id="insertEntitySystemParameter" parameterClass="com.huateng.framework.ibatis.model.EntitySystemParameter">
       insert into TB_ENTITY_SYSTEM_PARAMETER
		  ( PARAMETER_CODE,
			PARAMETER_NAME,
			PARAMETER_VALUE,
			PARAMETER_ROLE,
			PARAMETER_COMMENT,
			DATA_STATE,
			CREATE_USER,
			CREATE_TIME,
			MODIFY_USER,
			MODIFY_TIME,
			ENTITY_ID,
			FATHER_ENTITY_ID
		   )
	   SELECT
	       	PARAMETER_CODE,
			PARAMETER_NAME,
			PARAMETER_VALUE,
			PARAMETER_ROLE,
			PARAMETER_COMMENT,
			#dataState:VARCHAR#,
			#createUser:VARCHAR#,
            #createTime:VARCHAR#,
            #modifyUser:VARCHAR#,
            #modifyTime:VARCHAR#,
	        #entityId:VARCHAR#,
	        #fatherEntityId#
	   FROM
	       TB_ENTITY_SYSTEM_PARAMETER T
	   WHERE
	       T.DATA_STATE = '1' and T.ENTITY_ID=#fatherEntityId#
  </insert>
  <select id="selectConsumerIdByPosInfoId" parameterClass="com.allinfinance.univer.consumer.pos.dto.PosInfoDTO" resultClass="java.lang.String" remapResults="true">
   select t1.entity_id
  from tb_consumer t1
 where t1.entity_id =
       (select t2.father_entity_id
          from tb_merchant t2
         where t2.merchant_code =#mchntId#)    
  </select>
</sqlMap>