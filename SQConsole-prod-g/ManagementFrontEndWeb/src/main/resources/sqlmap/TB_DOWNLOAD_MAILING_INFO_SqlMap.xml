<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="TB_SELLORDER_DOWNLOAD">
<resultMap class="com.allinfinance.univer.seller.order.dto.SellOrderDownLoadDTO"  id="SellOrderDownLoadDTO" >
 <result column="orderId" jdbcType="VARCHAR" property="orderId" />
 <result column="orderType" jdbcType="VARCHAR" property="orderType" />
 <result column="cardNo" jdbcType="VARCHAR" property="cardNo" />
 <result column="contactPhone" jdbcType="VARCHAR" property="phone" />
 <result column="orderDate" jdbcType="CHAR" property="orderDate" />
 <result column="deliveryPoint" jdbcType="VARCHAR" property="receiver" />
 <result column="deliveryAddress" jdbcType="VARCHAR" property="addr" />
 <result column="deliveryPostcode" jdbcType="VARCHAR" property="postcode" />
 
</resultMap>
	<select id="selectMailingInfos" parameterClass="com.allinfinance.univer.seller.order.dto.SellOrderDownLoadDTO"
		resultMap="SellOrderDownLoadDTO">
	select T1.ORDER_ID as "orderId", T1.ORDER_TYPE as "orderType",T2.CARD_NO as "cardNo", T8.CONTACT_PHONE as "contactPhone",
	to_date(t1.order_date,'yyyy-MM-dd') as "orderDate",
	T9.DELIVERY_NAME as "deliveryPoint", T9.DELIVERY_ADDRESS as "deliveryAddress",T9.DELIVERY_POSTCODE as "deliveryPostcode"
	from TB_SELL_ORDER T1
	left join TB_SELL_ORDER_CARD_LIST T2 on t1.order_id=T2.order_id
	left join TB_DELIVERY_CONTACT T8 on T1.ORDER_CONTACT = T8.DELIVERY_CONTACT_ID
	left join TB_ENTITY_DELIVERY T9 on T1.DELIVERY_POINT = T9.DELIVERY_ID
	where 1=1 
	<isNotEmpty prepend="and" property="orderId" >
			T1.ORDER_ID in (#orderId:varchar#)
	</isNotEmpty>
	<isNotEmpty prepend="and" property="orderState" >
			T1.ORDER_STATE = #orderState:varchar#
	</isNotEmpty>
		<isNotEmpty prepend="and" property="deliveryMeans" >
			T1.DELIVERY_MEANS = #deliveryMeans:varchar#
	</isNotEmpty>
		<isNotEmpty prepend="and" property="initActStat" >
			T1.INIT_ACT_STAT = #initActStat:varchar#
	</isNotEmpty>
	<isNotEmpty prepend="and" property="startDate" >
			to_date(T1.ORDER_DATE,'YYYY-MM-DD') >= to_date(#startDate:VARCHAR#,'YYYY-MM-DD')
	</isNotEmpty>
	<isNotEmpty prepend="and" property="endDate" >
	<![CDATA[ 
		to_date(T1.ORDER_DATE,'YYYY-MM-DD') <= to_date(#endDate:VARCHAR#,'YYYY-MM-DD')
		]]>
	</isNotEmpty>
	
	</select>
	<update id="updateDownloadFalgByOrderId"  parameterClass="com.allinfinance.univer.seller.order.dto.SellOrderDownLoadDTO" >
	   update TB_SELL_ORDER set DOWNLOADFLAG = 1 where ORDER_ID in (<iterate property="orderIds" conjunction="," >
          		$orderIds[]$</iterate>)
	</update>
</sqlMap>