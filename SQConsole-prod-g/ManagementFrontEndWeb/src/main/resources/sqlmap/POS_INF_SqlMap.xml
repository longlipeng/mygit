<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="POS_INF">
  <select id="selectPosInfByDTO" parameterClass="com.allinfinance.univer.consumer.pos.dto.PosInfoQueryDTO" resultClass="java.util.HashMap" remapResults="true">
    <include refid="Commons.prefixSql"/>
    select
      T1.TERM_ID  as "termId",
      t1.Mchnt_Id   as "mchntId",
      T2.merchant_name as "mchntName",
      to_date(substr(T2.create_time,1,8), 'yyyy-mm-dd') as "createTime",
      T1.SHOP_ID   as "shopId",
	  T4.shop_address  as "shopAddress",
	  decode(T1.PRM_CHANGE_FLAG1,'0','否','是')  as "prmChangeFlag1",
	  decode(T1.PRM_CHANGE_FLAG2,'0','否','是')  as "prmChangeFlag2",
	  T4.shop_Telephone  as "phone",
	  T4.shop_name as "shopName",
	  decode(T1.TERM_STAT,'0','无效','有效')  as "termStat",
	  1 as "termType",
	  '内部' as "termTypeName",
      T4.shop_code as "shopCode"
     from
      TB_POS_INFO T1 left join
      TB_MERCHANT T2 on T1.MCHNT_ID=T2.MERCHANT_CODE left join
	  tb_shop T4 on T1.SHOP_ID = T4.shop_id
     where
      (T1.TERM_STAT = '0' or T1.TERM_STAT ='1')
      AND T2.merchant_STATE=1
      AND T1.DATA_STATE='1'
      AND T2.DATA_STATE='1'
     AND T2.FATHER_ENTITY_ID=#defaultEntityId:VARCHAR#
    <dynamic>
      <isNotEmpty prepend="and" property="termId">
        T1.TERM_ID = #termId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="termStat">
        T1.TERM_STAT = #termStat:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="and" property="mchntName">
        UPPER(T2.merchant_name) like UPPER('%'||#mchntName:VARCHAR#||'%')
      </isNotEmpty>
       <isNotEmpty prepend="and" property="shopCode">
        T4.SHOP_Code = #shopCode#
      </isNotEmpty> 
      <isNotEmpty prepend="and" property="shopId">
        T4.SHOP_ID = #shopId#
      </isNotEmpty> 
      <isNotEmpty prepend="and" property="shopName">
        T4.SHOP_NAME  like '%'||#shopName:VARCHAR#||'%'
      </isNotEmpty>      
       <isNotEmpty prepend="and" property="mchntId">
		t1.Mchnt_Id = #mchntId:VARCHAR#
	  </isNotEmpty>
	   <isNotEmpty prepend="and" property="shopAddress">
		T4.shop_address  like '%'||#shopAddress:VARCHAR#||'%'
	  </isNotEmpty>
	  <isNotEmpty prepend="and" property="merchantCode">
		T2.MERCHANT_CODE=#merchantCode:VARCHAR#
	  </isNotEmpty>
    </dynamic>
    <include refid="Commons.suffixSql"/>
  </select>
  
  
  <select id="selectShopPosByshopId" parameterClass="java.lang.Long" resultClass="com.allinfinance.univer.consumer.shoppos.dto.ShopPosDTO" remapResults="true">
    select
      T1.TERM_ID  as termId,
      decode(T1.TERM_STAT,0,'无效','有效')   as termStat,
      to_char(T1.CREATE_TIME,'yyyy-MM-dd')    as createTime
    from
      TB_POS_INF T1 left join
      TB_ENT_MERCHANT T2 on T1.MCHNT_ID=T2.MERCHANT_ID
    where
      T2.STATE=1
      AND T2.DATA_STATE='1'
   	 AND  T1.SHOP_ID =#shopId#
  </select>
</sqlMap>