<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="DepositProcessor">

	<insert id="insertTradeItemOrderRef" parameterClass="java.util.Map">
		<![CDATA[
			insert into CP_TRADE_ITEM_ORDER_REF(TRADE_ITEM_ID,REF_ORDER_ID,REF_ORDER_TYPE)
			select p.ID,#orderId#,#orderType# from CP_TRADE_ITEM_TEMP p where  p.MCHT_CODE=#mchtCode#
			and p.COUPON_NO=#couponNo# and p.BATCH_ID = #batchNo#
		]]>
	</insert>

	<insert id="insertTradeItemOrderRefByItem" parameterClass="java.util.Map">
		<![CDATA[
			insert into CP_TRADE_ITEM_ORDER_REF(TRADE_ITEM_ID,REF_ORDER_ID,REF_ORDER_TYPE)
			select p.ID,#orderId#,#orderType# from CP_TRADE_ITEM_TEMP p where  p.ITEM_ORDER_NO =#itemOrderNo#
			and p.BATCH_ID = #batchNo#
		]]>
	</insert>


	<update id="updateMinusInvoiceMoney" parameterClass="java.util.HashMap">
		<![CDATA[			
			update TB_INVOICE_REQUIREMENT R 
			set R.WAIT_AMOUNT = (R.WAIT_AMOUNT-#amount#),
                  R.UPDATED_TIME = current timestamp
            where id=#invoiceId#
		]]>
	</update>

	<update id="updateMinusInvoiceMoneyAndStatus" parameterClass="java.util.HashMap">
		<![CDATA[			
			update TB_INVOICE_REQUIREMENT R 
			set R.WAIT_AMOUNT = (R.WAIT_AMOUNT-#amount#),
                  R.UPDATED_TIME = current timestamp,
                  R.STATUS = #status#
            where id=#invoiceId#
		]]>
	</update>


</sqlMap>