<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="INVOICE_REQUIREMENT_SERVICE">
	<resultMap id="invoiceRequirementServiceResult"
		class="com.suning.svc.ibatis.model.InvoiceRequirement">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, 
			do not modify. This element was generated on Tue Oct 29 19:17:10 CST 2013. -->
		<result column="ID" property="id" jdbcType="BIGINT" />
		<result column="REF_ORDER_ID" property="refOrderId" jdbcType="BIGINT" />
		<result column="REF_ORDER_TYPE" property="refOrderType"
			jdbcType="VARCHAR" />
		<result column="YET_AMOUNT" property="yetAmount" jdbcType="BIGINT" />
		<result column="WAIT_AMOUNT" property="waitAmount" jdbcType="BIGINT" />
		<result column="INVOICE_NAME" property="invoiceName" jdbcType="VARCHAR" />
		<result column="CUSTOMER_ENTITY_ID" property="customerEntityId" jdbcType="VARCHAR" />
        <result column="FATHER_ENTITY_ID" property="fatherEntityId" jdbcType="VARCHAR" />
        <result column="STATUS" property="status" jdbcType="VARCHAR" />
		<result column="ASPECT" property="aspect" jdbcType="VARCHAR" />
		<result column="TYPE" property="type" jdbcType="VARCHAR" />
		<result column="CREATED_TIME" property="createdTime" jdbcType="TIMESTAMP" />
		<result column="UPDATED_TIME" property="updatedTime" jdbcType="TIMESTAMP" />
	</resultMap>
	<select id="abatorgenerated_selectInvoiceRequirement"
		parameterClass="com.allinfinance.svc.coupon.dto.InvoiceRequirementsDTO"
		resultClass="java.util.HashMap" remapResults="true">
		<include refid="Commons.prefixSql" />
		select
		ID as "id" ,REF_ORDER_ID as "refOrderId",REF_ORDER_TYPE as
		"refOrderType",YET_AMOUNT as "yetAmount",WAIT_AMOUNT as "waitAmount",
		INVOICE_NAME as "invoiceName",CUSTOMER_ENTITY_ID as "customerEntityId",FATHER_ENTITY_ID as "fatherEntityId" ,STATUS as "status",
		ASPECT as "aspect",TYPE as "type",CREATED_TIME as "createdTime",
		UPDATED_TIME
		as "updatedTime"
		from TB_INVOICE_REQUIREMENT
		where 1=1
		<isNotEmpty prepend="and" property="invoiceName">
			INVOICE_NAME =
			#invoiceName:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			STATUS =
			#status:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="aspect">
			ASPECT =
			#aspect:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="customerEntityId">
			CUSTOMER_ENTITY_ID =
			#customerEntityId:VARCHAR#
		</isNotEmpty>
		<include refid="Commons.suffixSql" />
	</select>
	<select id="queryInvoice" resultClass="java.util.HashMap"
		remapResults="true"
		parameterClass="com.allinfinance.univer.seller.invoice.dto.InvoiceReceiveQueryDTO">
		<include refid="Commons.prefixSql" />
		select t.ID as "id",t.NAME as "name",t.AMOUNT as "amount",t.OPEN_INVOICER as "openInvoicer",t.TYPE as "type",
		t.STATUS as "status",t.ASSIGNER as "assigner",t.ASSIGNED_TIME as "assignedTime",t.MCHT_ENTITY_ID as "mchtEntityId",b.merchant_name as "customerName",
		t.CHECK_INVOICER as "checkInvoicer",t.CHECKED_TIME as "checkedTime",t.HAND_INVOICER as "handInvoicer",t.HANDED_TIME as "handedTime",
		t.CREATED_TIME as "createdTime",t.INVOICE_NO as "invoiceNO",t.CUSTOMER_ENTITY_ID as "customerEntityId",t.INVOICE_PROJECT as "invoiceProject",t.UPDATED_TIME as "updatedTime"
		from TB_INVOICE t left join tb_merchant b on b.FATHER_ENTITY_ID = t.FATHER_ENTITY_ID and b.ENTITY_ID = t.MCHT_ENTITY_ID
		where 1=1
		<isNotEmpty prepend="and" property="name">
			t.NAME like
				'%'||#name:VARCHAR#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="type">
			t.TYPE=#type:varchar# 
		</isNotEmpty>
		<isNotEmpty prepend="and" property="customerEntityId">
			t.CUSTOMER_ENTITY_ID like
				'%'||#customerEntityId:VARCHAR#||'%'
		</isNotEmpty>
		<isNotEmpty prepend="and" property="invoiceProject">
			t.INVOICE_PROJECT=#invoiceProject:varchar# 
		</isNotEmpty>
		<isNotEmpty prepend="and" property="mchtEntityId">
			t.MCHT_ENTITY_ID=#mchtEntityId:varchar#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			t.STATUS=#status:varchar#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="startDate">
		to_char(t.CREATED_TIME,'yyyy-MM-dd') &gt;= #startDate#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="endDate">
		to_char(t.CREATED_TIME,'yyyy-MM-dd') &lt;= #endDate#
		</isNotEmpty>
		<include refid="Commons.suffixSql" />
	</select>
	
	<select id="querySumMchtInvoice" resultClass="java.util.HashMap" remapResults="true"
		parameterClass="com.allinfinance.svc.coupon.dto.InvoiceRequirementsDTO">
		<include refid="Commons.prefixSql" />
select a.mcht_id as "mchtId",
       a.wait_amount as "sumWaitAmount",
       nvl(c.customer_name, '') as "mchtName"
  from (select r.customer_entity_id as mcht_id,
               sum(r.wait_amount) as wait_amount
          from tb_invoice_requirement r
         where r.father_entity_id = '5101'
         group by r.customer_entity_id) a
  left join tb_customer c
    on a.mcht_id = c.entity_id
   and c.father_entity_id = '5101'
 where 1 = 1
			<isNotEmpty prepend="and" property="customerEntityId">
				a.mcht_id = #customerEntityId:varchar#
			</isNotEmpty>
 order by a.wait_amount desc
		<include refid="Commons.suffixSql" />
	</select>
	
</sqlMap>